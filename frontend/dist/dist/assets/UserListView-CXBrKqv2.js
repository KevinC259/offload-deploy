import{d as re,r as c,L as C,M as R,G as de,N as ne,c as P,a as u,p as $,b as l,w as o,f as g,O as ue,i as ie,t as F,P as pe,F as A,n as Q,E as _,u as me,Q as ce,k as w,J as ge,o as k,y as fe,_ as ve}from"./index-CSkJ4Wth.js";import{g as we,a as be,u as _e,d as ye}from"./user-C0k7ncu5.js";import"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const Ve={class:"userList-container"},Ue={class:"userList-table"},he={class:"userList-header"},ke={class:"userList-header-right"},xe={class:"userList-header-search"},Ie={class:"custom-pagination"},Ce={class:"pagination-total"},Pe={class:"pagination-sizes"},Fe=["value"],De=["disabled"],Le={class:"pagination-pages"},qe=["onClick"],Te=["disabled"],Me={class:"dialog-footer"},Re={class:"dialog-footer"},Ee=re({__name:"UserListView",setup(Ne){const E=c([]);c([]);const D=c(!0),i=c(1),y=c(10),G=[10,20,50],L=c(""),V=c(!1),U=c(!1),q=c(),T=c(),M=c(0),s=C({name:"",employeeId:"",account:"",password:"",confirmPassword:"",role:"",status:""}),r=C({id:"",name:"",employeeId:"",account:"",password:"",role:"",status:""}),J=C({name:[{required:!0,message:"请输入姓名",trigger:"blur"}],employeeId:[{required:!0,message:"请输入工号",trigger:"blur"}],account:[{required:!0,message:"请输入账号",trigger:"blur"}],password:[{required:!0,message:"请输入密码",trigger:"blur"},{min:3,message:"密码长度至少为3位",trigger:"blur"}],confirmPassword:[{required:!0,message:"请输入确认密码",trigger:"blur"},{validator:(t,e,n)=>{e!==s.password?n(new Error("两次输入的密码不一致")):n()},trigger:"blur"}],role:[{required:!0,message:"请选择角色",trigger:"change"}],status:[{required:!0,message:"请选择状态",trigger:"change"}]}),O=C({name:[{message:"请输入姓名",trigger:"blur"}],employeeId:[{message:"请输入工号",trigger:"blur"}],account:[{message:"请输入账号",trigger:"blur"}],password:[{message:"请输入密码",trigger:"blur"},{min:3,message:"密码长度至少为3位",trigger:"blur",validator:(t,e,n)=>{e&&e.length<3?n(new Error("密码长度至少为3位")):n()}}],role:[{message:"请选择角色",trigger:"change"}],status:[{message:"请选择状态",trigger:"change"}]}),h=R(()=>Math.ceil(M.value/y.value)||1),j=R(()=>E.value),H=R(()=>{if(h.value===0)return[1];const t=[],e=5;let n=Math.max(1,i.value-2),d=Math.min(h.value,n+e-1);d-n+1<e&&(n=Math.max(1,d-e+1));for(let m=n;m<=d;m++)t.push(m);return t}),K=async()=>{i.value=1,await f()},W=async()=>{i.value>1&&(i.value--,await f())},X=async()=>{i.value<h.value&&(i.value++,await f())},Y=async t=>{t>=1&&t<=h.value&&t!==i.value&&(i.value=t,await f())},N=async()=>{i.value=1,await f()},f=async()=>{try{D.value=!0;const t={pageNum:i.value,pageSize:y.value},e={keywords:L.value.trim(),pageRequest:t},n=await we(e);E.value=n.list.map(d=>({id:d.id,name:d.name,employeeId:d.workId,account:d.username,status:d.status==="1"?"启用":"禁用",password:d.password||"",workstationNum:d.workstationNum||"0",lastTime:d.lastTime||"",role:d.role==="admin"?"超级管理员":"普通用户"})),M.value=n.total}catch(t){console.error("Failed to load table data:",t),_.error("加载数据失败，请稍后重试")}finally{D.value=!1}},Z=()=>{var t;V.value=!0,s.name="",s.employeeId="",s.account="",s.password="",s.confirmPassword="",s.role="",s.status="",(t=q.value)==null||t.resetFields()},ee=t=>{var e;U.value=!0,r.id=t.id,r.name=t.name,r.employeeId=t.employeeId,r.account=t.account,r.password=t.password,r.role=t.role,r.status=t.status,(e=T.value)==null||e.resetFields()},x=()=>{V.value=!1,U.value=!1},le=async()=>{var t;(t=q.value)==null||t.validate(async e=>{if(e)try{const n={name:s.name,workId:s.employeeId,username:s.account,password:s.password,role:s.role==="超级管理员"?"admin":"user",status:s.status==="启用"?"1":"0"};await be(n),V.value=!1,await f()}catch(n){console.error("Failed to add user:",n),_.error("添加用户失败，请稍后重试")}else _.error("请填写完整信息")})},ae=async()=>{var t;(t=T.value)==null||t.validate(async e=>{if(e)try{const n={id:r.id,name:r.name,workId:r.employeeId,username:r.account,password:r.password,role:r.role==="超级管理员"?"admin":"user",status:r.status==="启用"?"1":"0"};await _e(n),U.value=!1,await f()}catch(n){console.error("Failed to edit user:",n),_.error("编辑用户失败，请稍后重试")}else _.error("请填写完整信息")})},oe=t=>{ge.confirm("确定要删除该用户吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e={id:t.id};await ye(e),await f()}catch(e){console.error("Failed to delete user:",e),_.error("删除用户失败，请稍后重试")}}).catch(()=>{})};return de(()=>{ne(()=>{f()})}),(t,e)=>{const n=g("el-icon"),d=g("el-input"),m=g("el-button"),b=g("el-table-column"),te=g("el-table"),p=g("el-form-item"),v=g("el-option"),I=g("el-select"),S=g("el-form"),B=g("el-dialog"),se=ue("loading");return k(),P("div",Ve,[u("div",Ue,[u("div",he,[e[18]||(e[18]=u("span",null,"用户列表",-1)),u("div",ke,[u("div",xe,[l(d,{modelValue:L.value,"onUpdate:modelValue":e[0]||(e[0]=a=>L.value=a),placeholder:"请输入工号或姓名",clearable:"",style:{width:"200px"},onInput:N,onClear:N},{suffix:o(()=>[l(n,null,{default:o(()=>[l(me(ce))]),_:1})]),_:1},8,["modelValue"])]),l(m,{type:"primary",onClick:Z},{default:o(()=>e[17]||(e[17]=[w("添加用户")])),_:1})])]),$((k(),ie(te,{data:j.value,style:{width:"100%"},"max-height":"600"},{default:o(()=>[l(b,{label:"序号",width:"80"},{default:o(a=>[w(F((i.value-1)*y.value+a.$index+1),1)]),_:1}),l(b,{prop:"name",label:"姓名",width:"150"}),l(b,{prop:"employeeId",label:"工号",width:"150"}),l(b,{prop:"account",label:"账号",width:"180"}),l(b,{prop:"role",label:"角色",width:"120"}),l(b,{prop:"lastTime",label:"最近一次登录时间",width:"200"}),l(b,{fixed:"right",label:"操作","min-width":"120"},{default:o(a=>[l(m,{link:"",type:"primary",size:"small",onClick:z=>ee(a.row)},{default:o(()=>e[19]||(e[19]=[w(" 编辑 ")])),_:2},1032,["onClick"]),l(m,{link:"",type:"danger",size:"small",onClick:z=>oe(a.row)},{default:o(()=>e[20]||(e[20]=[w(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[se,D.value]]),u("div",Ie,[u("span",Ce,"共 "+F(M.value)+" 条",1),u("div",Pe,[$(u("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>y.value=a),onChange:K},[(k(),P(A,null,Q(G,a=>u("option",{key:a,value:a},F(a)+" 条/页 ",9,Fe)),64))],544),[[pe,y.value]])]),u("button",{disabled:i.value===1,class:"pagination-btn",onClick:W}," 上一页 ",8,De),u("div",Le,[(k(!0),P(A,null,Q(H.value,a=>(k(),P("span",{key:a,class:fe(["page-item",{active:a===i.value}]),onClick:z=>Y(a)},F(a),11,qe))),128))]),u("button",{disabled:i.value===h.value,class:"pagination-btn",onClick:X}," 下一页 ",8,Te)]),l(B,{title:"添加用户",modelValue:V.value,"onUpdate:modelValue":e[9]||(e[9]=a=>V.value=a),width:"600px","before-close":x},{footer:o(()=>[u("span",Me,[l(m,{onClick:x},{default:o(()=>e[21]||(e[21]=[w("取消")])),_:1}),l(m,{type:"primary",onClick:le},{default:o(()=>e[22]||(e[22]=[w("确认")])),_:1})])]),default:o(()=>[l(S,{model:s,rules:J,ref_key:"addUserFormRef",ref:q,"label-width":"120px"},{default:o(()=>[l(p,{label:"姓名",prop:"name"},{default:o(()=>[l(d,{modelValue:s.name,"onUpdate:modelValue":e[2]||(e[2]=a=>s.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(p,{label:"工号",prop:"employeeId"},{default:o(()=>[l(d,{modelValue:s.employeeId,"onUpdate:modelValue":e[3]||(e[3]=a=>s.employeeId=a),placeholder:"请输入工号"},null,8,["modelValue"])]),_:1}),l(p,{label:"账号",prop:"account"},{default:o(()=>[l(d,{modelValue:s.account,"onUpdate:modelValue":e[4]||(e[4]=a=>s.account=a),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),l(p,{label:"密码",prop:"password"},{default:o(()=>[l(d,{modelValue:s.password,"onUpdate:modelValue":e[5]||(e[5]=a=>s.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(p,{label:"确认密码",prop:"confirmPassword"},{default:o(()=>[l(d,{modelValue:s.confirmPassword,"onUpdate:modelValue":e[6]||(e[6]=a=>s.confirmPassword=a),type:"password",placeholder:"请再次输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(p,{label:"角色",prop:"role"},{default:o(()=>[l(I,{modelValue:s.role,"onUpdate:modelValue":e[7]||(e[7]=a=>s.role=a),placeholder:"请选择角色"},{default:o(()=>[l(v,{label:"超级管理员",value:"超级管理员"}),l(v,{label:"普通用户",value:"普通用户"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"使用状态",prop:"status"},{default:o(()=>[l(I,{modelValue:s.status,"onUpdate:modelValue":e[8]||(e[8]=a=>s.status=a),placeholder:"请选择状态"},{default:o(()=>[l(v,{label:"启用",value:"启用"}),l(v,{label:"禁用",value:"禁用"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(B,{title:"编辑用户",modelValue:U.value,"onUpdate:modelValue":e[16]||(e[16]=a=>U.value=a),width:"500px","before-close":x},{footer:o(()=>[u("span",Re,[l(m,{onClick:x},{default:o(()=>e[23]||(e[23]=[w("取消")])),_:1}),l(m,{type:"primary",onClick:ae},{default:o(()=>e[24]||(e[24]=[w("确认")])),_:1})])]),default:o(()=>[l(S,{model:r,rules:O,ref_key:"editUserFormRef",ref:T,"label-width":"120px"},{default:o(()=>[l(p,{label:"姓名",prop:"name"},{default:o(()=>[l(d,{modelValue:r.name,"onUpdate:modelValue":e[10]||(e[10]=a=>r.name=a),placeholder:"请输入姓名"},null,8,["modelValue"])]),_:1}),l(p,{label:"工号",prop:"employeeId"},{default:o(()=>[l(d,{modelValue:r.employeeId,"onUpdate:modelValue":e[11]||(e[11]=a=>r.employeeId=a),placeholder:"请输入工号"},null,8,["modelValue"])]),_:1}),l(p,{label:"账号",prop:"account"},{default:o(()=>[l(d,{modelValue:r.account,"onUpdate:modelValue":e[12]||(e[12]=a=>r.account=a),placeholder:"请输入账号"},null,8,["modelValue"])]),_:1}),l(p,{label:"密码",prop:"password"},{default:o(()=>[l(d,{modelValue:r.password,"onUpdate:modelValue":e[13]||(e[13]=a=>r.password=a),type:"password",placeholder:"请输入密码","show-password":""},null,8,["modelValue"])]),_:1}),l(p,{label:"角色",prop:"role"},{default:o(()=>[l(I,{modelValue:r.role,"onUpdate:modelValue":e[14]||(e[14]=a=>r.role=a),placeholder:"请选择角色"},{default:o(()=>[l(v,{label:"超级管理员",value:"超级管理员"}),l(v,{label:"普通用户",value:"普通用户"})]),_:1},8,["modelValue"])]),_:1}),l(p,{label:"使用状态",prop:"status"},{default:o(()=>[l(I,{modelValue:r.status,"onUpdate:modelValue":e[15]||(e[15]=a=>r.status=a),placeholder:"请选择状态"},{default:o(()=>[l(v,{label:"启用",value:"启用"}),l(v,{label:"禁用",value:"禁用"})]),_:1},8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])])}}}),Qe=ve(Ee,[["__scopeId","data-v-be017927"]]);export{Qe as default};
