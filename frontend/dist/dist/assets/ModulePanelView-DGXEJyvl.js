import{d as Y,r as m,L as Z,M as K,G as Q,c as _,a as d,b as o,w as t,f as c,F as x,n as E,k as f,V as q,z as R,u as v,W as ee,t as U,X as le,e as J,Y as oe,Z as ae,$ as te,a0 as O,i as F,g as se,E as k,J as de,o as r,_ as ne}from"./index-CSkJ4Wth.js";import{c as ue,d as h,e as ie}from"./module-CucKkFkR.js";import"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const re={class:"search-filter-area"},ce={class:"dataSourceList-header"},pe={class:"dataSourceList-header-right"},me={class:"module-panel-page"},fe={class:"module-grid"},ve=["onClick"],be=["title"],_e={class:"card-header"},ge={class:"card-actions"},ye=["onClick"],Ve=["onClick"],Me={class:"card-content"},ke=["title"],we=["title"],Ce={class:"card-footer"},xe={class:"module-label"},Ue={class:"add-card-content"},Fe=Y({__name:"ModulePanelView",setup($e){const T=se(),u=m(!1),g=m([]),y=m(!1),V=m(!1),$=m(),w=m(),s=m({}),n=Z({name:"",label:"",description:"",color:void 0,subModules:[]}),S={name:[{required:!0,message:"模块名称不能为空",trigger:"blur"}],label:[{required:!0,message:"标签不能为空",trigger:"blur"}]},z=K(()=>s.value.id?g.value.filter(a=>a.id!==s.value.id):g.value),C=async()=>{try{u.value=!0;const a=await ue();g.value=a||[]}catch(a){console.error("获取模块列表失败:",a)}finally{u.value=!1}},j=a=>{T.push({path:"moduleConfig",query:{moduleId:a.id}})},I=async()=>{try{const a=await ie()}catch{k.error("导出配置失败")}},A=a=>{s.value=JSON.parse(JSON.stringify(a)),s.value.subModules||(s.value.subModules=[]),y.value=!0},G=async()=>{if($.value)try{await $.value.validate(),u.value=!0;const a={...s.value},e={id:a.id,name:a.name,label:a.label,description:a.description,color:a.color,subModules:a.subModules||[],type:"edit"};await h(e),await C(),y.value=!1,k.success("模块更新成功")}catch(a){console.error("模块更新失败:",a)}finally{u.value=!1}},H=()=>{var a;Object.assign(n,{name:"",label:"",description:"",color:void 0,subModules:[]}),V.value=!0,(a=w.value)==null||a.clearValidate()},W=async()=>{if(w.value)try{await w.value.validate(),u.value=!0;const a={id:"",name:n.name,label:n.label||"",description:n.description||"",color:n.color,subModules:n.subModules||[],type:"add"};await h(a),await C(),V.value=!1,k.success("模块添加成功")}catch(a){console.error("模块添加失败:",a)}finally{u.value=!1}},X=a=>{de.confirm(`确定要删除模块 <strong>${a.name}</strong> 吗？此操作不可撤销。`,"删除确认",{confirmButtonText:"确定删除",cancelButtonText:"取消",type:"warning",dangerouslyUseHTMLString:!0}).then(async()=>{try{u.value=!0;const e={id:a.id,name:"",type:"delete"};await h(e),await C(),k.success("模块删除成功")}catch(e){console.error("模块删除失败:",e)}finally{u.value=!1}}).catch(()=>{k.info("已取消删除")})};return Q(()=>{C()}),(a,e)=>{const p=c("el-button"),M=c("el-icon"),b=c("el-input"),i=c("el-form-item"),B=c("el-option"),D=c("el-select"),L=c("el-color-picker"),N=c("el-dialog");return r(),_(x,null,[d("div",re,[d("div",ce,[e[17]||(e[17]=d("span",null,"模块列表",-1)),d("div",pe,[o(p,{type:"primary",onClick:I},{default:t(()=>e[16]||(e[16]=[f("导出配置")])),_:1})])])]),d("div",me,[d("div",fe,[(r(!0),_(x,null,E(g.value,l=>(r(),_("div",{key:l.id,class:"module-card",style:q({"--module-accent-color":l.color||"#409EFF"}),onClick:P=>j(l)},[l.subModules&&l.subModules.length>0?(r(),_("div",{key:0,class:"subModules-badge",title:`包含 ${l.subModules.length} 个子模块`},[o(M,null,{default:t(()=>[o(v(ee))]),_:1}),d("span",null,U(l.subModules.length),1)],8,be)):R("",!0),d("div",_e,[d("div",{class:"card-icon-wrapper",style:q({backgroundColor:l.color||"#409EFF"})},[o(M,null,{default:t(()=>[o(v(le))]),_:1})],4),d("div",ge,[d("div",{class:"action-icon",onClick:J(P=>A(l),["stop"]),title:"编辑"},[o(M,null,{default:t(()=>[o(v(oe))]),_:1})],8,ye),d("div",{class:"action-icon",onClick:J(P=>X(l),["stop"]),title:"删除"},[o(M,null,{default:t(()=>[o(v(ae))]),_:1})],8,Ve)])]),d("div",Me,[d("h3",{class:"module-name",title:l.name},U(l.name||"未命名模块"),9,ke),d("p",{class:"module-description",title:l.description},U(l.description||"暂无描述"),9,we)]),d("div",Ce,[d("span",xe,U(l.label),1)])],12,ve))),128)),d("div",{class:"module-card add-card",onClick:H},[d("div",Ue,[o(M,null,{default:t(()=>[o(v(te))]),_:1}),e[18]||(e[18]=d("span",null,"添加新模块",-1))])])]),o(N,{modelValue:y.value,"onUpdate:modelValue":e[7]||(e[7]=l=>y.value=l),title:"编辑模块",width:"500px","close-on-click-modal":!1},{footer:t(()=>[o(p,{onClick:e[6]||(e[6]=l=>y.value=!1)},{default:t(()=>e[20]||(e[20]=[f("取消")])),_:1}),o(p,{type:"primary",onClick:G,loading:u.value},{default:t(()=>e[21]||(e[21]=[f("保存")])),_:1},8,["loading"])]),default:t(()=>[o(v(O),{model:s.value,rules:S,ref_key:"editFormRef",ref:$,"label-position":"top"},{default:t(()=>[o(i,{label:"模块名称",prop:"name"},{default:t(()=>[o(b,{modelValue:s.value.name,"onUpdate:modelValue":e[0]||(e[0]=l=>s.value.name=l),placeholder:"请输入模块名称"},null,8,["modelValue"])]),_:1}),o(i,{label:"标签",prop:"label"},{default:t(()=>[o(b,{modelValue:s.value.label,"onUpdate:modelValue":e[1]||(e[1]=l=>s.value.label=l),placeholder:"请输入标签 (e.g., OptimizationMethod)"},null,8,["modelValue"])]),_:1}),o(i,{label:"描述",prop:"description"},{default:t(()=>[o(b,{modelValue:s.value.description,"onUpdate:modelValue":e[2]||(e[2]=l=>s.value.description=l),type:"textarea",rows:3,placeholder:"请输入模块描述"},null,8,["modelValue"])]),_:1}),o(i,{label:"子模块 (可选)"},{default:t(()=>[o(D,{modelValue:s.value.subModules,"onUpdate:modelValue":e[3]||(e[3]=l=>s.value.subModules=l),multiple:"",filterable:"",placeholder:"选择子模块",style:{width:"100%"}},{default:t(()=>[(r(!0),_(x,null,E(z.value,l=>(r(),F(B,{key:l.id,label:l.name,value:l.id,disabled:l.id===s.value.id},null,8,["label","value","disabled"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"卡片颜色 (可选)"},{default:t(()=>[o(L,{modelValue:s.value.color,"onUpdate:modelValue":e[4]||(e[4]=l=>s.value.color=l),"show-alpha":""},null,8,["modelValue"]),s.value.color?(r(),F(p,{key:0,type:"text",style:{"margin-left":"10px"},onClick:e[5]||(e[5]=l=>s.value.color=void 0)},{default:t(()=>e[19]||(e[19]=[f("清除颜色")])),_:1})):R("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"]),o(N,{modelValue:V.value,"onUpdate:modelValue":e[15]||(e[15]=l=>V.value=l),title:"添加新模块",width:"500px","close-on-click-modal":!1},{footer:t(()=>[o(p,{onClick:e[14]||(e[14]=l=>V.value=!1)},{default:t(()=>e[23]||(e[23]=[f("取消")])),_:1}),o(p,{type:"primary",onClick:W,loading:u.value},{default:t(()=>e[24]||(e[24]=[f("确认")])),_:1},8,["loading"])]),default:t(()=>[o(v(O),{model:n,rules:S,ref_key:"addFormRef",ref:w,"label-position":"top"},{default:t(()=>[o(i,{label:"模块名称",prop:"name"},{default:t(()=>[o(b,{modelValue:n.name,"onUpdate:modelValue":e[8]||(e[8]=l=>n.name=l),placeholder:"请输入模块名称"},null,8,["modelValue"])]),_:1}),o(i,{label:"标签",prop:"label"},{default:t(()=>[o(b,{modelValue:n.label,"onUpdate:modelValue":e[9]||(e[9]=l=>n.label=l),placeholder:"请输入标签 (e.g., NewFeature)"},null,8,["modelValue"])]),_:1}),o(i,{label:"描述",prop:"description"},{default:t(()=>[o(b,{modelValue:n.description,"onUpdate:modelValue":e[10]||(e[10]=l=>n.description=l),type:"textarea",rows:3,placeholder:"请输入模块描述"},null,8,["modelValue"])]),_:1}),o(i,{label:"子模块 (可选)"},{default:t(()=>[o(D,{modelValue:n.subModules,"onUpdate:modelValue":e[11]||(e[11]=l=>n.subModules=l),multiple:"",filterable:"",placeholder:"选择子模块",style:{width:"100%"}},{default:t(()=>[(r(!0),_(x,null,E(g.value,l=>(r(),F(B,{key:l.id,label:l.name,value:l.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(i,{label:"卡片颜色 (可选)"},{default:t(()=>[o(L,{modelValue:n.color,"onUpdate:modelValue":e[12]||(e[12]=l=>n.color=l),"show-alpha":""},null,8,["modelValue"]),n.color?(r(),F(p,{key:0,type:"text",style:{"margin-left":"10px"},onClick:e[13]||(e[13]=l=>n.color=void 0)},{default:t(()=>e[22]||(e[22]=[f("清除颜色")])),_:1})):R("",!0)]),_:1})]),_:1},8,["model"])]),_:1},8,["modelValue"])])],64)}}}),De=ne(Fe,[["__scopeId","data-v-05a7a3c4"]]);export{De as default};
