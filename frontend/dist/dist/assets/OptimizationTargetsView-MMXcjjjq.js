import{d as ye,M as F,I as Oe,r as g,L as R,x as Ve,G as Te,c as h,a as m,z as De,p as Z,b as o,w as l,f as b,O as Se,i as L,t as S,P as xe,F as q,n as U,E as p,u as Ne,Q as ke,k as v,y as Ce,J as je,g as Me,o as _,_ as Fe}from"./index-CSkJ4Wth.js";import{i as ee,l as J,m as Re,e as ae}from"./function-CwdAX250.js";import"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const qe={class:"optimizationTargets-container"},Ue={class:"optimizationTargets-table"},Pe={class:"optimizationTargets-header"},Be={class:"optimizationTargets-header-right"},Ee={class:"optimizationTargets-header-search"},Ie={class:"custom-pagination"},$e={class:"pagination-total"},Le={class:"pagination-sizes"},Je=["value"],Ae=["disabled"],Ke={class:"pagination-pages"},Qe=["onClick"],Ge=["disabled"],We={class:"dialog-footer"},He={class:"dialog-footer"},Xe={key:0,class:"global-actions"},Ye=ye({__name:"OptimizationTargetsView",setup(Ze){const P=Me(),x=Oe(),B=F(()=>x.name==="nav_optimizationTargets"),E=g([]),y=g([]);g([]);const O=g(!0),n=g(1),z=g(10),te=[10,20,50],N=g(""),V=g(!1),T=g(!1),I=g(),$=g(),k=g(0),u=R({name:"",scalarName:"",optimizationDirection:"",weight:null,robustObject:!1}),r=R({id:"",name:"",scalarName:"",optimizationDirection:"",weight:null,robustObject:!1}),A=(a,e,i)=>{e==null?i(new Error("请输入权重")):isNaN(e)||e<=0?i(new Error("权重必须为大于0的数字")):i()},oe=R({name:[{required:!0,message:"请输入名称",trigger:"blur"}],scalarName:[{required:!0,message:"请选择Scalar",trigger:"change"}],optimizationDirection:[{required:!0,message:"请选择优化方向",trigger:"change"}],weight:[{required:!0,message:"请输入权重",trigger:"blur"},{validator:A,trigger:"blur"}]}),le=R({name:[{required:!0,message:"请输入名称",trigger:"blur"}],scalarName:[{required:!0,message:"请选择Scalar",trigger:"change"}],optimizationDirection:[{required:!0,message:"请选择优化方向",trigger:"change"}],weight:[{required:!0,message:"请输入权重",trigger:"blur"},{validator:A,trigger:"blur"}]}),D=F(()=>Math.ceil(k.value/z.value)||1),K=F(()=>{const a=(n.value-1)*z.value,e=a+z.value;return y.value.slice(a,e).map(i=>({...i,robustObject:i.robustObject==="1"}))}),ie=F(()=>{if(D.value===0)return[1];const a=[],e=5;let i=Math.max(1,n.value-2),s=Math.min(D.value,i+e-1);s-i+1<e&&(i=Math.max(1,s-e+1));for(let d=i;d<=s;d++)a.push(d);return a}),ne=()=>{n.value=1},re=()=>{n.value>1&&n.value--},se=()=>{n.value<D.value&&n.value++},ue=a=>{a>=1&&a<=D.value&&a!==n.value&&(n.value=a)},Q=()=>{n.value=1},de=async()=>{try{const a={pageNum:1,pageSize:1e3},i=await ee({name:"",type:"dataSource",page:a}),d=await ee({name:"",type:"expression",page:a});E.value=[...i.list.map(c=>({id:c.id,name:c.name})),...d.list.map(c=>({id:c.id,name:c.name}))]}catch(a){console.error("Failed to load scalar list:",a),p.error("加载Scalar列表失败，请稍后重试")}},C=async()=>{try{O.value=!0;const a={pageNum:n.value,pageSize:z.value},e={scalarName:N.value.trim(),page:a},i=await Re(e);y.value=i.list,k.value=i.total}catch(a){console.error("Failed to load optimization target list:",a),p.error("加载优化目标列表失败，请稍后重试")}finally{O.value=!1}},me=()=>{var a;Object.assign(u,{name:"",scalarName:"",optimizationDirection:"",weight:null,robustObject:!1}),V.value=!0,(a=I.value)==null||a.resetFields()},ce=a=>{var e;Object.assign(r,{id:a.id,name:a.name,scalarName:a.scalarName,optimizationDirection:a.optimizationDirection,weight:parseFloat(a.weight),robustObject:a.robustObject==="1"}),T.value=!0,(e=$.value)==null||e.resetFields()},j=()=>{V.value=!1,T.value=!1},pe=()=>{var a;(a=I.value)==null||a.validate(async e=>{var i;if(e)try{const s={id:"",operationType:"add",name:u.name,scalarName:u.scalarName,optimizationDirection:u.optimizationDirection,weight:((i=u.weight)==null?void 0:i.toString())||"",robustObject:u.robustObject?"1":"0"};await J(s),p.success("添加成功"),await C(),V.value=!1}catch(s){console.error("Failed to add optimization target:",s),p.error("添加优化目标失败，请稍后重试")}else p.error("请填写完整并正确的信息")})},ge=()=>{var a;(a=$.value)==null||a.validate(async e=>{var i;if(e)try{const s={id:r.id,operationType:"edit",name:r.name,scalarName:r.scalarName,optimizationDirection:r.optimizationDirection,weight:((i=r.weight)==null?void 0:i.toString())||"",robustObject:r.robustObject?"1":"0"};await J(s),p.success("编辑成功"),await C(),T.value=!1}catch(s){console.error("Failed to edit optimization target:",s),p.error("编辑优化目标失败，请稍后重试")}else p.error("请填写完整并正确的信息")})},ve=a=>{je.confirm("确定要删除该优化目标吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e={id:a.id,operationType:"delete",name:a.name,scalarName:a.scalarName,optimizationDirection:a.optimizationDirection,weight:a.weight,robustObject:a.robustObject?"1":"0"};await J(e),p.success("删除成功"),K.value.length===1&&n.value>1&&n.value--,await C()}catch(e){console.error("Failed to delete optimization target:",e),p.error("删除优化目标失败，请稍后重试")}}).catch(()=>{})},be=()=>{B.value?P.push({name:"nav_scalar"}):P.back()},G=async()=>{try{O.value=!0;const a=await ae(),e=`optimizationTargets_${String(x.name)}`,i={optimizationTargets:y.value,timestamp:new Date().toISOString(),routeName:String(x.name)};localStorage.setItem(e,JSON.stringify(i))}catch(a){console.error("保存配置失败:",a),p.error("保存配置失败")}finally{O.value=!1}},fe=async()=>{try{const a={optimizationTargets:y.value,timestamp:new Date().toISOString(),stepName:"优化目标"};await ae(),console.log("优化目标配置已保存到后端:",a)}catch(a){throw console.error("保存配置失败:",a),a}},_e=async()=>{try{await G(),await fe(),p.success("配置已保存并导出，正在跳转到下一步"),P.push({name:"nav_globalParam"})}catch(a){console.error("下一步操作失败:",a),p.error("操作失败，请重试")}},ze=()=>{if(B.value)try{const a=`optimizationTargets_${String(x.name)}`,e=localStorage.getItem(a);if(e){const i=JSON.parse(e);i.optimizationTargets&&(y.value=i.optimizationTargets,k.value=i.optimizationTargets.length)}}catch(a){console.error("加载配置失败:",a)}};return Ve([n,z,N],()=>{C()},{immediate:!0}),Te(async()=>{ze(),await de()}),(a,e)=>{const i=b("el-icon"),s=b("el-input"),d=b("el-button"),c=b("el-table-column"),he=b("el-table"),f=b("el-form-item"),w=b("el-option"),M=b("el-select"),W=b("el-checkbox"),H=b("el-form"),X=b("el-dialog"),we=Se("loading");return _(),h("div",qe,[m("div",Ue,[m("div",Pe,[e[15]||(e[15]=m("span",null,"优化目标列表",-1)),m("div",Be,[m("div",Ee,[o(s,{modelValue:N.value,"onUpdate:modelValue":e[0]||(e[0]=t=>N.value=t),placeholder:"请输入Scalar名称",clearable:"",style:{width:"200px"},onInput:Q,onClear:Q},{suffix:l(()=>[o(i,null,{default:l(()=>[o(Ne(ke))]),_:1})]),_:1},8,["modelValue"])]),o(d,{type:"primary",onClick:me},{default:l(()=>e[14]||(e[14]=[v("添加优化目标")])),_:1})])]),Z((_(),L(he,{data:K.value,style:{width:"100%"},"max-height":"600"},{default:l(()=>[o(c,{label:"序号",width:"100"},{default:l(t=>[v(S((n.value-1)*z.value+t.$index+1),1)]),_:1}),o(c,{prop:"name",label:"名称",width:"150"}),o(c,{prop:"scalarName",label:"Scalar",width:"150"}),o(c,{prop:"optimizationDirection",label:"优化方向",width:"150"}),o(c,{prop:"weight",label:"权重",width:"150"}),o(c,{prop:"robustObject",label:"鲁棒性优化",width:"150"},{default:l(t=>[v(S(t.row.robustObject?"是":"否"),1)]),_:1}),o(c,{fixed:"right",label:"操作","min-width":"120"},{default:l(t=>[o(d,{link:"",type:"primary",size:"small",onClick:Y=>ce(t.row)},{default:l(()=>e[16]||(e[16]=[v(" 编辑 ")])),_:2},1032,["onClick"]),o(d,{link:"",type:"danger",size:"small",onClick:Y=>ve(t.row)},{default:l(()=>e[17]||(e[17]=[v(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[we,O.value]]),m("div",Ie,[m("span",$e,"共 "+S(k.value)+" 条",1),m("div",Le,[Z(m("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>z.value=t),onChange:ne},[(_(),h(q,null,U(te,t=>m("option",{key:t,value:t},S(t)+" 条/页 ",9,Je)),64))],544),[[xe,z.value]])]),m("button",{disabled:n.value===1,class:"pagination-btn",onClick:re}," 上一页 ",8,Ae),m("div",Ke,[(_(!0),h(q,null,U(ie.value,t=>(_(),h("span",{key:t,class:Ce(["page-item",{active:t===n.value}]),onClick:Y=>ue(t)},S(t),11,Qe))),128))]),m("button",{disabled:n.value===D.value,class:"pagination-btn",onClick:se}," 下一页 ",8,Ge)]),o(X,{title:"添加优化目标",modelValue:V.value,"onUpdate:modelValue":e[7]||(e[7]=t=>V.value=t),width:"600px","before-close":j},{footer:l(()=>[m("span",We,[o(d,{onClick:j},{default:l(()=>e[18]||(e[18]=[v("取消")])),_:1}),o(d,{type:"primary",onClick:pe},{default:l(()=>e[19]||(e[19]=[v("确认")])),_:1})])]),default:l(()=>[o(H,{model:u,rules:oe,ref_key:"addOptimizationTargetFormRef",ref:I,"label-width":"100px"},{default:l(()=>[o(f,{label:"名称",prop:"name"},{default:l(()=>[o(s,{modelValue:u.name,"onUpdate:modelValue":e[2]||(e[2]=t=>u.name=t),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),o(f,{label:"Scalar",prop:"scalarName"},{default:l(()=>[o(M,{modelValue:u.scalarName,"onUpdate:modelValue":e[3]||(e[3]=t=>u.scalarName=t),placeholder:"请选择Scalar"},{default:l(()=>[(_(!0),h(q,null,U(E.value,t=>(_(),L(w,{key:t.id,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"优化方向",prop:"optimizationDirection"},{default:l(()=>[o(M,{modelValue:u.optimizationDirection,"onUpdate:modelValue":e[4]||(e[4]=t=>u.optimizationDirection=t),placeholder:"请选择优化方向"},{default:l(()=>[o(w,{label:"Minimize",value:"Minimize"}),o(w,{label:"Maximize",value:"Maximize"})]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"权重",prop:"weight"},{default:l(()=>[o(s,{modelValue:u.weight,"onUpdate:modelValue":e[5]||(e[5]=t=>u.weight=t),modelModifiers:{number:!0},type:"number",placeholder:"请输入权重"},null,8,["modelValue"])]),_:1}),o(f,{label:"是否作为鲁棒性优化对象",prop:"robustObject","label-width":"200px"},{default:l(()=>[o(W,{modelValue:u.robustObject,"onUpdate:modelValue":e[6]||(e[6]=t=>u.robustObject=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),o(X,{title:"编辑优化目标",modelValue:T.value,"onUpdate:modelValue":e[13]||(e[13]=t=>T.value=t),width:"600px","before-close":j},{footer:l(()=>[m("span",He,[o(d,{onClick:j},{default:l(()=>e[20]||(e[20]=[v("取消")])),_:1}),o(d,{type:"primary",onClick:ge},{default:l(()=>e[21]||(e[21]=[v("确认")])),_:1})])]),default:l(()=>[o(H,{model:r,rules:le,ref_key:"editOptimizationTargetFormRef",ref:$,"label-width":"100px"},{default:l(()=>[o(f,{label:"名称",prop:"name"},{default:l(()=>[o(s,{modelValue:r.name,"onUpdate:modelValue":e[8]||(e[8]=t=>r.name=t),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),o(f,{label:"Scalar",prop:"scalarName"},{default:l(()=>[o(M,{modelValue:r.scalarName,"onUpdate:modelValue":e[9]||(e[9]=t=>r.scalarName=t),placeholder:"请选择Scalar"},{default:l(()=>[(_(!0),h(q,null,U(E.value,t=>(_(),L(w,{key:t.id,label:t.name,value:t.name},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"优化方向",prop:"optimizationDirection"},{default:l(()=>[o(M,{modelValue:r.optimizationDirection,"onUpdate:modelValue":e[10]||(e[10]=t=>r.optimizationDirection=t),placeholder:"请选择优化方向"},{default:l(()=>[o(w,{label:"Minimize",value:"Minimize"}),o(w,{label:"Maximize",value:"Maximize"})]),_:1},8,["modelValue"])]),_:1}),o(f,{label:"权重",prop:"weight"},{default:l(()=>[o(s,{modelValue:r.weight,"onUpdate:modelValue":e[11]||(e[11]=t=>r.weight=t),modelModifiers:{number:!0},type:"number",placeholder:"请输入权重"},null,8,["modelValue"])]),_:1}),o(f,{label:"是否作为鲁棒性优化对象",prop:"robustObject","label-width":"200px"},{default:l(()=>[o(W,{modelValue:r.robustObject,"onUpdate:modelValue":e[12]||(e[12]=t=>r.robustObject=t)},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),B.value?(_(),h("div",Xe,[o(d,{onClick:be},{default:l(()=>e[22]||(e[22]=[v("返回")])),_:1}),o(d,{type:"primary",onClick:G},{default:l(()=>e[23]||(e[23]=[v("保存配置")])),_:1}),o(d,{type:"primary",onClick:_e},{default:l(()=>e[24]||(e[24]=[v("下一步")])),_:1})])):De("",!0)])}}}),ia=Fe(Ye,[["__scopeId","data-v-dea268da"]]);export{ia as default};
