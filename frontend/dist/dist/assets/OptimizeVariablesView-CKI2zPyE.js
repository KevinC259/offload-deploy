import{_ as va,M as J,I as ca,r as f,x as ma,G as _a,c as p,a as e,z as w,b as l,w as s,k as v,f as P,p as g,O as ga,i as Z,t as m,P as N,F as S,n as $,y as aa,R as M,E as b,J as ba,g as ya,o as r}from"./index-CSkJ4Wth.js";import"./request-Bb7olHYx.js";import{g as ta,d as fa,a as wa,u as za,e as ea}from"./function-CwdAX250.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const ka={class:"optimize-variables-container"},ha={key:0,class:"optimize-variables-module"},Ca={class:"optimize-variables-table"},xa={class:"optimize-variables-header"},Va={class:"optimize-variables-header-right"},Oa={class:"table-wrapper"},Sa={class:"empty-state"},Ta={key:0,class:"custom-pagination"},Na={class:"pagination-total"},$a={class:"pagination-sizes"},Ma=["value"],Da=["disabled"],Ia={class:"pagination-pages"},Pa=["onClick"],Ba=["disabled"],Ua={key:1,class:"optimize-variables-module"},La={class:"optimize-variables-table"},Ea={class:"optimize-variables-header"},Aa={class:"optimize-variables-header-right"},Ja={class:"table-wrapper"},qa={class:"empty-state"},Fa={key:0,class:"custom-pagination"},Ra={class:"pagination-total"},Ka={class:"pagination-sizes"},ja=["value"],Ga=["disabled"],Ha={class:"pagination-pages"},Qa=["onClick"],Wa=["disabled"],Xa={key:2,class:"global-actions"},Ya={key:0,class:"el-overlay"},Za={class:"el-dialog"},at={class:"el-dialog__header"},tt={class:"el-dialog__title"},et={class:"el-dialog__body"},ot={class:"form-group"},nt=["disabled"],it=["value"],lt={key:0},st={class:"form-group"},rt={class:"form-group"},ut={class:"inline-group-container"},dt={class:"form-group"},pt={class:"form-group"},vt={key:1},ct={class:"form-group"},mt={class:"constraint-group"},_t={class:"el-dialog__footer"},gt=["disabled"],bt={key:0},yt={key:1},ft={__name:"OptimizeVariablesView",setup(wt){const B=ya(),D=ca(),U=J(()=>D.name==="nav_optimizeVariables"),z=f(!1),h=f("add"),oa=f(-1),i=f(null),c=f(!1),_=f([]),L=[{value:"param_optimization",text:"参数优化"},{value:"constraint_area",text:"约束条件"}],y=f(5),q=[5,10,20,50],d=f({param_optimization:1,constraint_area:1}),k=f({param_optimization:0,constraint_area:0});J(()=>{const o={};return _.value.forEach(a=>{o[a.operationType]||(o[a.operationType]=[]),o[a.operationType].push(a)}),o});const F=J(()=>_.value.length===0),C=async(o=null)=>{try{if(c.value=!0,o){const a=d.value[o],n=await ta({operationType:o,page:{pageNum:a,pageSize:y.value}}),u=_.value.filter(V=>V.operationType!==o);_.value=[...u,...n.list],k.value[o]=n.total}else{_.value=[];for(const a of L){const n=d.value[a.value],u=await ta({operationType:a.value,page:{pageNum:n,pageSize:y.value}});_.value=[..._.value,...u.list],k.value[a.value]=u.total}}}catch(a){console.error("获取优化参数列表失败:",a),b.error("获取数据失败")}finally{c.value=!1}},na=async o=>{try{c.value=!0;const a=await wa(o);return b.success("添加成功"),await C(o.operationType),a}catch(a){throw console.error("添加优化参数失败:",a),b.error("添加失败"),a}finally{c.value=!1}},ia=async o=>{try{c.value=!0,await za(o),b.success("更新成功"),await C(o.operationType)}catch(a){throw console.error("更新优化参数失败:",a),b.error("更新失败"),a}finally{c.value=!1}},la=async(o,a)=>{try{c.value=!0,await fa({id:o}),b.success("删除成功"),await C(a)}catch(n){throw console.error("删除优化参数失败:",n),b.error("删除失败"),n}finally{c.value=!1}},R=o=>{var a;return((a=L.find(n=>n.value===o))==null?void 0:a.text)||"未知操作"},E=o=>_.value.filter(a=>a.operationType===o),K=o=>E(o),A=o=>Math.ceil(k.value[o]/y.value),j=o=>{const a=A(o),n=d.value[o],u=[],V=Math.max(1,n-2),I=Math.min(a,n+2);for(let O=V;O<=I;O++)u.push(O);return u},x=async(o,a)=>{d.value[o]=a,await C(o)},G=async()=>{Object.keys(d.value).forEach(o=>{d.value[o]=1}),await C()},H=o=>{const a={operationType:o,operationTypeName:R(o),data:{}};switch(o){case"param_optimization":a.data={variableName:"new_var",range:[0,1],quantization:"0",distribution:"uniform"};break;case"constraint_area":a.data={constraint:"",operator:"=="};break}return a},Q=(o="param_optimization")=>{h.value="add",i.value=H(o),z.value=!0},W=o=>{h.value="edit";const a=_.value.findIndex(n=>n.id===o.id);oa.value=a,i.value=JSON.parse(JSON.stringify(o)),z.value=!0},sa=async()=>{if(i.value.operationType)try{i.value.operationTypeName=R(i.value.operationType),h.value==="add"?await na(i.value):await ia(i.value),z.value=!1}catch(o){console.error("操作失败:",o)}},X=(o,a)=>{ba.confirm("您确定要删除这个操作吗？","提示",{confirmButtonText:"确认",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await la(o.id,o.operationType)}catch(n){console.error("删除失败:",n)}}).catch(()=>{})},ra=()=>{U.value?B.push({name:"nav_inputModule"}):B.back()},Y=async()=>{try{c.value=!0;const o=await ea(),a=`optimizeVariables_${String(D.name)}`,n={operationList:_.value,timestamp:new Date().toISOString(),routeName:D.name};localStorage.setItem(a,JSON.stringify(n))}catch(o){console.error("保存配置失败:",o),b.error("保存配置失败")}finally{c.value=!1}},ua=async()=>{try{const o={operationList:_.value,timestamp:new Date().toISOString(),stepName:"优化变量"};await ea(),console.log("优化变量配置已保存到后端:",o)}catch(o){console.error("保存配置失败:",o),b.error("保存配置失败")}},da=async()=>{try{await Y(),await ua(),b.success("配置已保存并导出，正在跳转到下一步"),B.push({name:"nav_dataSource"})}catch(o){console.error("下一步操作失败:",o),b.error("操作失败，请重试")}},pa=()=>{if(U.value)try{const o=`optimizeVariables_${String(D.name)}`,a=localStorage.getItem(o);if(a){const n=JSON.parse(a);_.value=n.operationList||[]}}catch(o){console.error("加载配置失败:",o)}};return ma(()=>{var o;return(o=i.value)==null?void 0:o.operationType},o=>{z.value&&h.value==="add"&&o&&(i.value=H(o))}),_a(async()=>{pa(),await C()}),(o,a)=>{const n=P("el-button"),u=P("el-table-column"),V=P("el-empty"),I=P("el-table"),O=ga("loading");return r(),p(S,null,[e("div",ka,[F.value||E("param_optimization").length>0?(r(),p("div",ha,[e("div",Ca,[e("div",xa,[a[19]||(a[19]=e("span",null,"参数优化",-1)),e("div",Va,[l(n,{type:"primary",onClick:a[0]||(a[0]=t=>Q("param_optimization"))},{default:s(()=>a[18]||(a[18]=[v("添加")])),_:1})])]),e("div",Oa,[g((r(),Z(I,{data:K("param_optimization"),style:{width:"100%"},height:"100%"},{empty:s(()=>[e("div",Sa,[l(V,{description:"暂无参数优化数据"})])]),default:s(()=>[l(u,{label:"序号",width:"150"},{default:s(t=>[v(m((d.value.param_optimization-1)*y.value+t.$index+1),1)]),_:1}),l(u,{prop:"data.variableName",label:"参数名",width:"300"}),l(u,{label:"范围",width:"150"},{default:s(t=>[v(" ["+m(t.row.data.range[0])+", "+m(t.row.data.range[1])+"] ",1)]),_:1}),l(u,{prop:"data.quantization",label:"量化长度(bit)",width:"150"}),l(u,{prop:"data.distribution",label:"分布情况",width:"150"}),l(u,{fixed:"right",label:"操作","min-width":"120"},{default:s(t=>[l(n,{size:"small",type:"primary",onClick:T=>W(t.row)},{default:s(()=>a[20]||(a[20]=[v("编辑")])),_:2},1032,["onClick"]),l(n,{size:"small",type:"danger",onClick:T=>X(t.row,t.$index,"param_optimization")},{default:s(()=>a[21]||(a[21]=[v("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,c.value]]),k.value.param_optimization>0?(r(),p("div",Ta,[e("span",Na,"共 "+m(k.value.param_optimization)+" 条",1),e("div",$a,[g(e("select",{"onUpdate:modelValue":a[1]||(a[1]=t=>y.value=t),onChange:G},[(r(),p(S,null,$(q,t=>e("option",{key:t,value:t},m(t)+" 条/页 ",9,Ma)),64))],544),[[N,y.value]])]),e("button",{disabled:d.value.param_optimization===1,class:"pagination-btn",onClick:a[2]||(a[2]=t=>x("param_optimization",d.value.param_optimization-1))}," 上一页 ",8,Da),e("div",Ia,[(r(!0),p(S,null,$(j("param_optimization"),t=>(r(),p("span",{key:t,class:aa(["page-item",{active:t===d.value.param_optimization}]),onClick:T=>x("param_optimization",t)},m(t),11,Pa))),128))]),e("button",{disabled:d.value.param_optimization===A("param_optimization"),class:"pagination-btn",onClick:a[3]||(a[3]=t=>x("param_optimization",d.value.param_optimization+1))}," 下一页 ",8,Ba)])):w("",!0)])])])):w("",!0),F.value||E("constraint_area").length>0?(r(),p("div",Ua,[e("div",La,[e("div",Ea,[a[23]||(a[23]=e("span",null,"约束条件",-1)),e("div",Aa,[l(n,{type:"primary",onClick:a[4]||(a[4]=t=>Q("constraint_area"))},{default:s(()=>a[22]||(a[22]=[v("添加")])),_:1})])]),e("div",Ja,[g((r(),Z(I,{data:K("constraint_area"),style:{width:"100%"},height:"100%"},{empty:s(()=>[e("div",qa,[l(V,{description:"暂无约束条件数据"})])]),default:s(()=>[l(u,{label:"序号",width:"150"},{default:s(t=>[v(m((d.value.constraint_area-1)*y.value+t.$index+1),1)]),_:1}),l(u,{label:"约束表达式",width:"300"},{default:s(t=>[v(m(t.row.data.constraint),1)]),_:1}),l(u,{label:"操作符",width:"150"},{default:s(t=>[v(m(t.row.data.operator),1)]),_:1}),l(u,{label:"值",width:"150"},{default:s(t=>a[24]||(a[24]=[v(" 0 ")])),_:1}),l(u,{fixed:"right",label:"操作","min-width":"120"},{default:s(t=>[l(n,{size:"small",type:"primary",onClick:T=>W(t.row)},{default:s(()=>a[25]||(a[25]=[v("编辑")])),_:2},1032,["onClick"]),l(n,{size:"small",type:"danger",onClick:T=>X(t.row,t.$index,"constraint_area")},{default:s(()=>a[26]||(a[26]=[v("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[O,c.value]]),k.value.constraint_area>0?(r(),p("div",Fa,[e("span",Ra,"共 "+m(k.value.constraint_area)+" 条",1),e("div",Ka,[g(e("select",{"onUpdate:modelValue":a[5]||(a[5]=t=>y.value=t),onChange:G},[(r(),p(S,null,$(q,t=>e("option",{key:t,value:t},m(t)+" 条/页 ",9,ja)),64))],544),[[N,y.value]])]),e("button",{disabled:d.value.constraint_area===1,class:"pagination-btn",onClick:a[6]||(a[6]=t=>x("constraint_area",d.value.constraint_area-1))}," 上一页 ",8,Ga),e("div",Ha,[(r(!0),p(S,null,$(j("constraint_area"),t=>(r(),p("span",{key:t,class:aa(["page-item",{active:t===d.value.constraint_area}]),onClick:T=>x("constraint_area",t)},m(t),11,Qa))),128))]),e("button",{disabled:d.value.constraint_area===A("constraint_area"),class:"pagination-btn",onClick:a[7]||(a[7]=t=>x("constraint_area",d.value.constraint_area+1))}," 下一页 ",8,Wa)])):w("",!0)])])])):w("",!0),U.value?(r(),p("div",Xa,[l(n,{onClick:ra},{default:s(()=>a[27]||(a[27]=[v("返回")])),_:1}),l(n,{type:"primary",onClick:Y},{default:s(()=>a[28]||(a[28]=[v("保存配置")])),_:1}),l(n,{type:"primary",onClick:da},{default:s(()=>a[29]||(a[29]=[v("下一步")])),_:1})])):w("",!0)]),z.value?(r(),p("div",Ya,[e("div",Za,[e("div",at,[e("span",tt,m(h.value==="add"?"添加新操作":"编辑操作"),1),e("button",{class:"el-dialog__headerbtn",onClick:a[8]||(a[8]=t=>z.value=!1)},a[30]||(a[30]=[e("svg",{xmlns:"http://www.w3.org/2000/svg",viewBox:"0 0 1024 1024"},[e("path",{fill:"currentColor",d:"M764.288 214.592 512 466.88 259.712 214.592a31.936 31.936 0 0 0-45.12 45.12L466.88 512 214.592 764.288a31.936 31.936 0 1 0 45.12 45.12L512 557.12l252.288 252.288a31.936 31.936 0 0 0 45.12-45.12L557.12 512l252.288-252.288a31.936 31.936 0 1 0-45.12-45.12z"})],-1)]))]),e("div",et,[e("div",ot,[a[31]||(a[31]=e("label",null,"操作类型:",-1)),g(e("select",{class:"el-select","onUpdate:modelValue":a[9]||(a[9]=t=>i.value.operationType=t),disabled:h.value==="edit"},[(r(),p(S,null,$(L,t=>e("option",{key:t.value,value:t.value},m(t.text),9,it)),64))],8,nt),[[N,i.value.operationType]])]),i.value.operationType==="param_optimization"?(r(),p("div",lt,[e("div",st,[a[32]||(a[32]=e("label",null,"参数名:",-1)),g(e("input",{type:"text",class:"el-input","onUpdate:modelValue":a[10]||(a[10]=t=>i.value.data.variableName=t)},null,512),[[M,i.value.data.variableName]])]),e("div",rt,[a[33]||(a[33]=e("label",null,"范围:",-1)),e("div",ut,[g(e("input",{type:"number",class:"el-input","onUpdate:modelValue":a[11]||(a[11]=t=>i.value.data.range[0]=t),placeholder:"最小值"},null,512),[[M,i.value.data.range[0],void 0,{number:!0}]]),g(e("input",{type:"number",class:"el-input","onUpdate:modelValue":a[12]||(a[12]=t=>i.value.data.range[1]=t),placeholder:"最大值"},null,512),[[M,i.value.data.range[1],void 0,{number:!0}]])])]),e("div",dt,[a[34]||(a[34]=e("label",null,"量化长度 (bit):",-1)),g(e("input",{type:"text",class:"el-input","onUpdate:modelValue":a[13]||(a[13]=t=>i.value.data.quantization=t)},null,512),[[M,i.value.data.quantization]])]),e("div",pt,[a[36]||(a[36]=e("label",null,"分布情况:",-1)),g(e("select",{class:"el-select","onUpdate:modelValue":a[14]||(a[14]=t=>i.value.data.distribution=t)},a[35]||(a[35]=[e("option",{value:"uniform"},"uniform",-1),e("option",{value:"normal"},"normal",-1)]),512),[[N,i.value.data.distribution]])])])):w("",!0),i.value.operationType==="constraint_area"?(r(),p("div",vt,[e("div",ct,[a[39]||(a[39]=e("label",null,"约束表达式:",-1)),e("div",mt,[g(e("input",{type:"text",class:"el-input","onUpdate:modelValue":a[15]||(a[15]=t=>i.value.data.constraint=t),placeholder:"例: w_slot1 + h_slot2"},null,512),[[M,i.value.data.constraint]]),g(e("select",{class:"el-select","onUpdate:modelValue":a[16]||(a[16]=t=>i.value.data.operator=t)},a[37]||(a[37]=[e("option",null,"==",-1),e("option",null,">",-1),e("option",null,"<",-1),e("option",null,">=",-1),e("option",null,"<=",-1)]),512),[[N,i.value.data.operator]]),a[38]||(a[38]=e("span",null,"0",-1))])])])):w("",!0)]),e("div",_t,[e("button",{class:"el-button",onClick:a[17]||(a[17]=t=>z.value=!1)},a[40]||(a[40]=[e("span",null,"取消",-1)])),e("button",{class:"el-button el-button--primary",onClick:sa,disabled:c.value},[c.value?(r(),p("span",bt,"提交中...")):(r(),p("span",yt,"确认"))],8,gt)])])])):w("",!0)],64)}}},Vt=va(ft,[["__scopeId","data-v-ca113c4e"]]);export{Vt as default};
