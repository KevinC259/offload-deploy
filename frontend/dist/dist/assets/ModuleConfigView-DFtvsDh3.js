import{d as _e,L as H,r as g,M as Ue,G as Ne,I as Ie,x as ee,c as w,a as v,z as O,b as u,t as I,i as m,w as n,f as x,g as Le,E as s,k as c,F as P,n as A,u as Se,a0 as Oe,N as K,J as M,o as r,_ as Pe}from"./index-CSkJ4Wth.js";import{f as le,g as ae,a as Ae,u as te,b as Be,h as $}from"./module-CucKkFkR.js";import"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const Ee={class:"module-config-view"},Me={class:"card algorithm-selection-section"},$e={class:"card-header"},je={class:"card-title"},Re={class:"actions"},Fe={class:"card-description"},qe={class:"form-group"},Je={style:{flex:"1"}},ze={key:0,class:"form-group"},Ge={key:1,class:"no-algorithm-selected"},He={key:0,class:"card algorithm-params-section"},Ke={class:"card-header"},Qe={class:"card-title"},We={key:0,class:"params-container"},Xe={key:1,class:"no-params"},Ye={class:"dialog-footer"},Ze={style:{flex:"1"}},el={style:{flex:"1"}},ll={class:"dialog-footer"},al=_e({__name:"ModuleConfigView",setup(tl){const j=Le(),R=Ie(),V=H({id:"",name:"",label:"模块",description:"配置模块的算法和参数"}),T=g([]),y=g([]),F=g([]),h=g(""),q=g(""),J=g(""),D=g([]),B=g(!1),L=g(!1),i=Ue(()=>y.value.find(l=>l.id===h.value)),_=g(!1),U=g(!1),a=H(W()),oe=g(-1),S=g(null),Q=async l=>{if(!l){s.error("未找到模块ID，请检查路由参数"),j.push("/modules");return}y.value=[],h.value="",D.value=[],T.value=[],V.id=l;try{await Promise.all([z(),ue(),ie()])}catch(e){console.error("初始化模块失败:",e)}};Ne(()=>{Q(R.query.moduleId)}),ee(()=>R.query.moduleId,(l,e)=>{l&&l!==e&&Q(l)},{immediate:!1});const ue=async()=>{try{const l=await le({id:V.id});T.value=l||[]}catch(l){throw s.error("获取子模块列表失败"),console.error("获取子模块列表失败:",l),l}},ne=()=>{B.value=!0},re=l=>{l&&l.subModuleId&&(B.value=!1,j.replace({query:{...R.query,moduleId:l.subModuleId}}))},z=async()=>{try{const l=await ae({id:V.id});y.value=l||[],y.value.length>0?(h.value=y.value[0].id,await E()):(h.value="",D.value=[])}catch(l){throw s.error("获取算法列表失败"),console.error("获取算法列表失败:",l),l}},ie=async()=>{try{const l=await le({id:V.id});if(T.value=l||[],T.value.length>0){const e=await ae({id:T.value[0].subModuleId});F.value=e||[]}}catch(l){throw s.error("获取算法列表失败"),console.error("获取算法列表失败:",l),l}},se=()=>{h.value?E():D.value=[]},E=async()=>{if(h.value)try{const l=await Ae({id:h.value});D.value=l||[]}catch(l){s.error("获取参数列表失败"),console.error("获取参数列表失败:",l)}},de=async()=>{if(i.value)try{await $({id:i.value.id,name:i.value.name,label:i.value.label,moduleId:V.id,type:"edit"}),s.success("算法标签更新成功")}catch{s.error("算法标签更新失败")}};function W(){return{id:"",algorithmId:h.value,name:"",label:"",value:"",paramType:"str",paramDefault:"",paramOption:null,minValue:null,maxValue:null}}ee(()=>a.paramType,(l,e)=>{l!==e&&(l==="bool"?(a.value=!0,a.paramDefault=!0):l==="int"||l==="float"?(a.value=0,a.paramDefault=0):(a.value="",a.paramDefault=""),C(l)||(a.minValue=null,a.maxValue=null),l!=="enum"&&(a.paramOption=null),K(()=>{var o;(o=S.value)==null||o.clearValidate()}))});const me=l=>{if(l.type==="bool")return l.value==="true"?"True":"False";if(l.type==="int"||l.type==="float"){const e=Number(l.value);return isNaN(e)?l.value:e}return l.value},pe=l=>{if(l.type==="bool")return l.defaultValue==="true"?"True":"False";if(l.type==="int"||l.type==="float"){const e=Number(l.defaultValue);return isNaN(e)?l.defaultValue:e}return l.defaultValue},ve=H({name:[{required:!0,message:"请输入参数名称",trigger:"blur"},{validator:(l,e,o)=>{D.value.some(f=>f.name===String(e)&&f.id!==a.id)?o(new Error("参数名称已存在，请确保唯一性")):o()},trigger:"blur"}],label:[{required:!0,message:"请输入参数标签",trigger:"blur"}],paramType:[{required:!0,message:"请选择参数类型",trigger:"change"}],value:[{required:!0,message:"请输入参数值",trigger:["change","blur"]}],paramDefault:[{required:!0,message:"请输入参数默认值",trigger:["change","blur"]}],paramOption:[{validator:(l,e,o)=>{a.paramType==="enum"&&(!e||String(e).trim()==="")?o(new Error("请输入枚举选项，使用逗号分隔")):o()},trigger:"blur"}],minValue:[{validator:(l,e,o)=>{C(a.paramType)&&e!==null&&a.maxValue!==null&&Number(e)>Number(a.maxValue)?o(new Error("最小值不能大于最大值")):o()},trigger:"change"}],maxValue:[{validator:(l,e,o)=>{C(a.paramType)&&e!==null&&a.minValue!==null&&Number(e)<Number(a.minValue)?o(new Error("最大值不能小于最小值")):o()},trigger:"change"}]}),C=l=>l==="int"||l==="float",fe=l=>l==="bool"?"当前布尔值":l==="enum"?"当前枚举值":"当前参数值",ce=l=>l==="bool"?"默认布尔值":l==="enum"?"默认枚举值":"参数默认值",X=l=>l?l.split(",").map(e=>e.trim()).filter(e=>e):[],be=()=>{M.prompt("请输入新算法的唯一名称 (Name)","新增算法",{confirmButtonText:"确定",cancelButtonText:"取消",inputPattern:/\S+/,inputErrorMessage:"算法名称不能为空",beforeClose:(l,e,o)=>{if(l==="confirm"){const d=e.inputValue.trim();if(y.value.some(f=>f.name===d)){s.error("算法名称已存在，请重新输入！");return}o()}else o()}}).then(async({value:l})=>{const e={id:"",name:l.trim(),label:l.trim(),moduleId:V.id,type:"add"};try{await $(e),s.success("算法添加成功"),await z();const o=y.value.find(d=>d.name===l.trim());o&&(h.value=o.id)}catch{s.error("算法添加失败")}}).catch(()=>{s.info("取消添加算法")})},Ve=()=>{if(!i.value)return;const l=i.value.name;M.prompt(`正在重命名算法：${i.value.label}
请输入新的唯一名称 (Name)`,"重命名算法",{confirmButtonText:"确定",cancelButtonText:"取消",inputValue:l,inputPattern:/\S+/,inputErrorMessage:"算法名称不能为空",beforeClose:(e,o,d)=>{if(e==="confirm"){const f=o.inputValue.trim();if(f!==l&&y.value.some(b=>{var p;return b.name===f&&b.id!==((p=i.value)==null?void 0:p.id)})){s.error("新的算法名称已存在，请确保唯一性！");return}d()}else d()}}).then(async({value:e})=>{if(!i.value||e.trim()===l){e.trim()===l&&s.info("算法名称未改变");return}try{await $({id:i.value.id,name:e.trim(),label:i.value.label,moduleId:V.id,type:"edit"}),s.success("算法重命名成功"),i.value.name=e.trim();const o=y.value.find(d=>d.id===i.value.id);o&&(o.name=e.trim())}catch{s.error("算法重命名失败")}}).catch(()=>{s.info("取消重命名算法")})},ye=()=>{i.value&&M.confirm(`确定要删除算法 "${i.value.label}" (唯一名称: ${i.value.name}) 吗？此操作不可逆。`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await $({id:i.value.id,name:i.value.name,label:i.value.label,moduleId:V.id,type:"delete"}),s.success("算法删除成功"),z()}catch{s.error("算法删除失败")}}).catch(()=>{s.info("取消删除算法")})},ge=()=>{i.value&&(Object.assign(a,W()),a.algorithmId=i.value.id,U.value=!1,_.value=!0,K(()=>{var l;return(l=S.value)==null?void 0:l.clearValidate()}))},he=(l,e)=>{oe.value=l;const o={id:e.id,algorithmId:h.value,name:e.name,label:e.label,paramType:e.type,value:e.type==="bool"?e.value==="true":C(e.type)?Number(e.value):e.value,paramDefault:e.type==="bool"?e.defaultValue==="true":C(e.type)?Number(e.defaultValue):e.defaultValue,paramOption:e.options?e.options.join(","):null,minValue:e.minValue,maxValue:e.maxValue};Object.assign(a,o),U.value=!0,_.value=!0,K(()=>{var d;return(d=S.value)==null?void 0:d.clearValidate()})},we=()=>{var l;(l=S.value)==null||l.validate(async e=>{if(e){const o={id:a.id,algorithmId:a.algorithmId,name:String(a.name),label:String(a.label),paramType:String(a.paramType),value:String(a.value),paramDefault:String(a.paramDefault),paramOption:a.paramOption||"",minValue:a.minValue!==null?String(a.minValue):"",maxValue:a.maxValue!==null?String(a.maxValue):"",type:U.value?"edit":"add"};try{await te(o),s.success(U.value?"参数更新成功":"参数添加成功"),E(),_.value=!1}catch{s.error(U.value?"参数更新失败":"参数添加失败")}}else s.error("请检查表单填写是否完整和正确！")})},xe=(l,e)=>{M.confirm(`确定要删除参数 "${e.label}" (名称: ${e.name}) 吗？`,"警告",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const o={id:e.id,algorithmId:"",name:e.name,label:e.label,value:e.value,paramType:e.type,paramDefault:e.defaultValue,paramOption:e.options?e.options.join(","):"",minValue:e.minValue!==null?String(e.minValue):"",maxValue:e.maxValue!==null?String(e.maxValue):"",type:"delete"};await te(o),s.success("参数删除成功"),E()}catch{s.error("参数删除失败")}}).catch(()=>{s.info("取消删除参数")})},ke=async()=>{L.value=!0},Te=async(l,e)=>{console.log("子算法ID:",V.id);try{const o=await Be({id:l,subid:e,currentid:V.id}),d=JSON.stringify(o,null,4),f=new Blob([d],{type:"application/json"}),b=URL.createObjectURL(f),p=document.createElement("a");p.href=b,p.download=`module_config_${V.id}.json`,document.body.appendChild(p),p.click(),document.body.removeChild(p),URL.revokeObjectURL(b),s.success("配置已导出为JSON文件")}catch{s.error("导出配置失败")}L.value=!1},De=()=>j.back();return(l,e)=>{const o=x("el-button"),d=x("el-option"),f=x("el-select"),b=x("el-input"),p=x("el-table-column"),Y=x("el-table"),k=x("el-form-item"),N=x("el-input-number"),Z=x("el-switch"),G=x("el-dialog");return r(),w("div",Ee,[v("div",Me,[v("div",$e,[v("span",je,I(V.label)+"配置",1),v("div",Re,[T.value.length>0?(r(),m(o,{key:0,type:"primary",onClick:ne},{default:n(()=>e[29]||(e[29]=[c(" 子模块 ")])),_:1})):O("",!0),u(o,{type:"success",onClick:be},{default:n(()=>e[30]||(e[30]=[c("新增算法")])),_:1}),u(o,{type:"warning",onClick:Ve,disabled:!i.value},{default:n(()=>e[31]||(e[31]=[c("重命名算法")])),_:1},8,["disabled"]),u(o,{type:"danger",onClick:ye,disabled:!i.value},{default:n(()=>e[32]||(e[32]=[c("删除当前算法")])),_:1},8,["disabled"]),u(o,{type:"info",onClick:ke},{default:n(()=>e[33]||(e[33]=[c("导出配置")])),_:1}),u(o,{type:"primary",onClick:e[0]||(e[0]=t=>De())},{default:n(()=>e[34]||(e[34]=[c("返回")])),_:1})])]),v("span",Fe,I(V.description),1),v("div",qe,[e[35]||(e[35]=v("label",null,"选择优化算法",-1)),v("div",Je,[u(f,{modelValue:h.value,"onUpdate:modelValue":e[1]||(e[1]=t=>h.value=t),placeholder:"请选择优化算法",disabled:!y.value.length,style:{width:"100%"},onChange:se},{default:n(()=>[(r(!0),w(P,null,A(y.value,t=>(r(),m(d,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),i.value?(r(),w("div",ze,[e[36]||(e[36]=v("label",null,"算法显示标签 (Label)",-1)),u(b,{modelValue:i.value.label,"onUpdate:modelValue":e[2]||(e[2]=t=>i.value.label=t),placeholder:"请输入算法显示标签",onBlur:de},null,8,["modelValue"])])):(r(),w("div",Ge,"请选择或新增一个算法进行配置。"))]),i.value?(r(),w("div",He,[v("div",Ke,[v("span",Qe,"算法："+I(i.value.name)+" 参数设置",1),u(o,{type:"success",onClick:ge},{default:n(()=>e[37]||(e[37]=[c("新增参数")])),_:1})]),D.value.length>0?(r(),w("div",We,[u(Y,{data:D.value,border:"",style:{width:"100%"}},{default:n(()=>[u(p,{prop:"label",label:"参数标签",width:"180"}),u(p,{prop:"name",label:"参数名称",width:"180"}),u(p,{prop:"type",label:"类型",width:"100"}),u(p,{prop:"value",label:"当前值","min-width":"150","show-overflow-tooltip":""},{default:n(({row:t})=>[c(I(me(t)),1)]),_:1}),u(p,{prop:"defaultValue",label:"默认值","min-width":"150","show-overflow-tooltip":""},{default:n(({row:t})=>[c(I(pe(t)),1)]),_:1}),u(p,{label:"枚举选项","min-width":"150","show-overflow-tooltip":""},{default:n(({row:t})=>[c(I(t.options?t.options.join(","):""),1)]),_:1}),u(p,{prop:"minValue",label:"最小值",width:"80"}),u(p,{prop:"maxValue",label:"最大值",width:"80"}),u(p,{label:"操作",width:"150",fixed:"right"},{default:n(t=>[u(o,{size:"small",onClick:Ce=>he(t.$index,t.row)},{default:n(()=>e[38]||(e[38]=[c("编辑")])),_:2},1032,["onClick"]),u(o,{size:"small",type:"danger",onClick:Ce=>xe(t.$index,t.row)},{default:n(()=>e[39]||(e[39]=[c("删除")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])])):(r(),w("div",Xe,"该算法暂无参数设置"))])):O("",!0),u(G,{modelValue:_.value,"onUpdate:modelValue":e[22]||(e[22]=t=>_.value=t),title:U.value?"编辑参数":"新增参数",width:"600px"},{footer:n(()=>[v("span",Ye,[u(o,{onClick:e[21]||(e[21]=t=>_.value=!1)},{default:n(()=>e[40]||(e[40]=[c("取消")])),_:1}),u(o,{type:"primary",onClick:we},{default:n(()=>e[41]||(e[41]=[c("保存")])),_:1})])]),default:n(()=>[u(Se(Oe),{model:a,"label-width":"150px",ref_key:"paramFormRef",ref:S,rules:ve},{default:n(()=>[u(k,{label:"参数名称",prop:"name"},{default:n(()=>[u(b,{modelValue:a.name,"onUpdate:modelValue":e[3]||(e[3]=t=>a.name=t),placeholder:"参数的唯一名称标识"},null,8,["modelValue"])]),_:1}),u(k,{label:"参数标签",prop:"label"},{default:n(()=>[u(b,{modelValue:a.label,"onUpdate:modelValue":e[4]||(e[4]=t=>a.label=t),placeholder:"用户友好的参数标签"},null,8,["modelValue"])]),_:1}),u(k,{label:"参数类型",prop:"paramType"},{default:n(()=>[u(f,{modelValue:a.paramType,"onUpdate:modelValue":e[5]||(e[5]=t=>a.paramType=t),placeholder:"请选择参数类型",style:{width:"100%"}},{default:n(()=>[u(d,{label:"文本 (str)",value:"str"}),u(d,{label:"整数 (int)",value:"int"}),u(d,{label:"浮点数 (float)",value:"float"}),u(d,{label:"布尔 (bool)",value:"bool"}),u(d,{label:"枚举 (enum)",value:"enum"})]),_:1},8,["modelValue"])]),_:1}),a.paramType==="enum"?(r(),m(k,{key:0,label:"枚举选项 (逗号分隔)",prop:"paramOption"},{default:n(()=>[u(b,{modelValue:a.paramOption,"onUpdate:modelValue":e[6]||(e[6]=t=>a.paramOption=t),placeholder:"例如: 选项1,选项2,选项3"},null,8,["modelValue"])]),_:1})):O("",!0),u(k,{label:fe(a.paramType),prop:"value"},{default:n(()=>[a.paramType==="str"?(r(),m(b,{key:0,modelValue:a.value,"onUpdate:modelValue":e[7]||(e[7]=t=>a.value=t),placeholder:"请输入参数值"},null,8,["modelValue"])):a.paramType==="int"?(r(),m(N,{key:1,modelValue:a.value,"onUpdate:modelValue":e[8]||(e[8]=t=>a.value=t),"controls-position":"right",step:1,precision:0,style:{width:"100%"}},null,8,["modelValue"])):a.paramType==="float"?(r(),m(N,{key:2,modelValue:a.value,"onUpdate:modelValue":e[9]||(e[9]=t=>a.value=t),"controls-position":"right",precision:3,step:.01,style:{width:"100%"}},null,8,["modelValue"])):a.paramType==="bool"?(r(),m(Z,{key:3,modelValue:a.value,"onUpdate:modelValue":e[10]||(e[10]=t=>a.value=t),"active-text":"True","inactive-text":"False","active-value":!0,"inactive-value":!1},null,8,["modelValue"])):a.paramType==="enum"?(r(),m(f,{key:4,modelValue:a.value,"onUpdate:modelValue":e[11]||(e[11]=t=>a.value=t),placeholder:"请选择或输入枚举值",style:{width:"100%"}},{default:n(()=>[(r(!0),w(P,null,A(X(a.paramOption),t=>(r(),m(d,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(r(),m(b,{key:5,modelValue:a.value,"onUpdate:modelValue":e[12]||(e[12]=t=>a.value=t),placeholder:"请选择参数类型以输入值",disabled:""},null,8,["modelValue"]))]),_:1},8,["label"]),u(k,{label:ce(a.paramType),prop:"paramDefault"},{default:n(()=>[a.paramType==="str"?(r(),m(b,{key:0,modelValue:a.paramDefault,"onUpdate:modelValue":e[13]||(e[13]=t=>a.paramDefault=t),placeholder:"请输入默认值"},null,8,["modelValue"])):a.paramType==="int"?(r(),m(N,{key:1,modelValue:a.paramDefault,"onUpdate:modelValue":e[14]||(e[14]=t=>a.paramDefault=t),"controls-position":"right",step:1,precision:0,style:{width:"100%"}},null,8,["modelValue"])):a.paramType==="float"?(r(),m(N,{key:2,modelValue:a.paramDefault,"onUpdate:modelValue":e[15]||(e[15]=t=>a.paramDefault=t),"controls-position":"right",precision:3,step:.01,style:{width:"100%"}},null,8,["modelValue"])):a.paramType==="bool"?(r(),m(Z,{key:3,modelValue:a.paramDefault,"onUpdate:modelValue":e[16]||(e[16]=t=>a.paramDefault=t),"active-text":"True","inactive-text":"False","active-value":!0,"inactive-value":!1},null,8,["modelValue"])):a.paramType==="enum"?(r(),m(f,{key:4,modelValue:a.paramDefault,"onUpdate:modelValue":e[17]||(e[17]=t=>a.paramDefault=t),placeholder:"请选择或输入枚举默认值",style:{width:"100%"}},{default:n(()=>[(r(!0),w(P,null,A(X(a.paramOption),t=>(r(),m(d,{key:t,label:t,value:t},null,8,["label","value"]))),128))]),_:1},8,["modelValue"])):(r(),m(b,{key:5,modelValue:a.paramDefault,"onUpdate:modelValue":e[18]||(e[18]=t=>a.paramDefault=t),placeholder:"请选择参数类型以输入默认值",disabled:""},null,8,["modelValue"]))]),_:1},8,["label"]),C(a.paramType)?(r(),m(k,{key:1,label:"最小值",prop:"minValue"},{default:n(()=>[u(N,{modelValue:a.minValue,"onUpdate:modelValue":e[19]||(e[19]=t=>a.minValue=t),"controls-position":"right",step:a.paramType==="int"?1:.01,style:{width:"100%"}},null,8,["modelValue","step"])]),_:1})):O("",!0),C(a.paramType)?(r(),m(k,{key:2,label:"最大值",prop:"maxValue"},{default:n(()=>[u(N,{modelValue:a.maxValue,"onUpdate:modelValue":e[20]||(e[20]=t=>a.maxValue=t),"controls-position":"right",step:a.paramType==="int"?1:.01,style:{width:"100%"}},null,8,["modelValue","step"])]),_:1})):O("",!0)]),_:1},8,["model","rules"])]),_:1},8,["modelValue","title"]),u(G,{modelValue:B.value,"onUpdate:modelValue":e[23]||(e[23]=t=>B.value=t),width:"500px","custom-class":"submodule-dialog","show-close":!1},{default:n(()=>[u(Y,{data:T.value,style:{width:"100%"},onRowClick:re,"header-cell-class-name":"submodule-table-header"},{default:n(()=>[u(p,{prop:"subModuleName",label:"选择子模块"})]),_:1},8,["data"])]),_:1},8,["modelValue"]),u(G,{modelValue:L.value,"onUpdate:modelValue":e[28]||(e[28]=t=>L.value=t),width:"500px","custom-class":"submodule-dialog","show-close":!1},{footer:n(()=>[v("span",ll,[u(o,{onClick:e[26]||(e[26]=t=>L.value=!1)},{default:n(()=>e[42]||(e[42]=[c("取消")])),_:1}),u(o,{type:"primary",onClick:e[27]||(e[27]=t=>Te(q.value,J.value))},{default:n(()=>e[43]||(e[43]=[c("导出")])),_:1})])]),default:n(()=>[e[44]||(e[44]=v("label",null,"选择优化算法",-1)),v("div",Ze,[u(f,{modelValue:q.value,"onUpdate:modelValue":e[24]||(e[24]=t=>q.value=t),placeholder:"请选择优化算法",disabled:!y.value.length,style:{width:"100%"}},{default:n(()=>[(r(!0),w(P,null,A(y.value,t=>(r(),m(d,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])]),e[45]||(e[45]=v("label",null,"选择子模块算法",-1)),v("div",el,[u(f,{modelValue:J.value,"onUpdate:modelValue":e[25]||(e[25]=t=>J.value=t),placeholder:"请选择优化算法",disabled:!F.value.length,style:{width:"100%"}},{default:n(()=>[(r(!0),w(P,null,A(F.value,t=>(r(),m(d,{key:t.id,label:t.name,value:t.id},null,8,["label","value"]))),128))]),_:1},8,["modelValue","disabled"])])]),_:1},8,["modelValue"])])}}}),sl=Pe(al,[["__scopeId","data-v-ca1a8fdf"]]);export{sl as default};
