import{d as me,r as m,L as k,M as H,G as ce,c as R,a as r,p as W,b as l,w as t,f as c,O as ve,i as z,t as _,P as fe,F as C,n as S,E as b,u as be,Q as Ae,k as v,y as ge,J as _e,o as g,_ as Ve}from"./index-CSkJ4Wth.js";import{i as X,n as Ke,o as B}from"./function-CwdAX250.js";import"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const Re={class:"robustnessAnalysis-container"},he={class:"robustnessAnalysis-table"},Ne={class:"robustnessAnalysis-header"},qe={class:"robustnessAnalysis-header-right"},xe={class:"robustnessAnalysis-header-search"},we={class:"custom-pagination"},ke={class:"pagination-total"},Ce={class:"pagination-sizes"},Se=["value"],Te=["disabled"],Ue={class:"pagination-pages"},De=["onClick"],Me=["disabled"],Pe={class:"dialog-footer"},Ee={class:"dialog-footer"},Fe=me({__name:"RobustnessAnalysisView",setup(ze){const L=m([]),T=m(!0),u=m(1),h=m(10),Y=[10,20,50],U=m(""),D=m(0),M=m([]),x=m(!0),V=m(!1),N=m(!1),P=m(),E=m(),o=k({name:"",scalarName:"",varianceAnalysis:!1,qualityAnalysis:!1,sensitivityAnalysis:!1,topK:null}),n=k({id:"",name:"",scalarName:"",varianceAnalysis:!1,qualityAnalysis:!1,sensitivityAnalysis:!1,topK:null}),I=(s,e,i)=>{(V.value?o.sensitivityAnalysis:n.sensitivityAnalysis)?e==null||e.toString().trim()===""?i(new Error("请输入TopK")):!Number.isInteger(e)||e<1?i(new Error("TopK必须为大于或等于1的整数")):i():i()},Z=k({name:[{required:!0,message:"请输入名称",trigger:"blur"}],scalarName:[{required:!0,message:"请选择标量名称",trigger:"change"}],topK:[{validator:I,trigger:"blur"}]}),ee=k({name:[{required:!0,message:"请输入名称",trigger:"blur"}],scalarName:[{required:!0,message:"请选择标量名称",trigger:"change"}],topK:[{validator:I,trigger:"blur"}]}),q=H(()=>Math.ceil(D.value/h.value)||1),ae=H(()=>{if(q.value===0)return[1];const s=[],e=5;let i=Math.max(1,u.value-2),p=Math.min(q.value,i+e-1);p-i+1<e&&(i=Math.max(1,p-e+1));for(let d=i;d<=p;d++)s.push(d);return s}),le=async()=>{try{x.value=!0;const s={pageNum:1,pageSize:1e3},e={name:"",type:"dataSource",page:s},i={name:"",type:"expression",page:s},[p,d]=await Promise.all([X(e),X(i)]),f=[...p.list||[],...d.list||[]];M.value=[...new Set(f.map(F=>F.name))]}catch(s){console.error("加载标量列表失败:",s),b.error("加载标量列表失败，请稍后重试")}finally{x.value=!1}},A=async()=>{try{T.value=!0;const s={scalarName:U.value.trim(),page:{pageNum:u.value,pageSize:h.value}},e=await Ke(s);L.value=e.list||[],D.value=e.total||0}catch(s){console.error("加载鲁棒性分析列表失败:",s),b.error("加载数据失败，请稍后重试")}finally{T.value=!1}},se=()=>{u.value=1,A()},te=()=>{u.value>1&&(u.value--,A())},ne=()=>{u.value<q.value&&(u.value++,A())},oe=s=>{s>=1&&s<=q.value&&s!==u.value&&(u.value=s,A())},$=()=>{u.value=1,A()},ie=()=>{var s;V.value=!0,o.name="",o.scalarName="",o.varianceAnalysis=!1,o.qualityAnalysis=!1,o.sensitivityAnalysis=!1,o.topK=null,(s=P.value)==null||s.resetFields()},re=s=>{var e;N.value=!0,n.id=s.id,n.name=s.name,n.scalarName=s.scalarName,n.varianceAnalysis=s.varianceAnalysis==="1",n.qualityAnalysis=s.qualityAnalysis==="1",n.sensitivityAnalysis=s.sensitivityAnalysis==="1",n.topK=s.topK?Number(s.topK):null,(e=E.value)==null||e.resetFields()},w=()=>{V.value=!1,N.value=!1},ue=async()=>{const s=P.value;s&&await s.validate(async e=>{if(e)try{const i={id:"",operationType:"add",name:o.name,scalarName:o.scalarName,varianceAnalysis:o.varianceAnalysis?"1":"0",qualityAnalysis:o.qualityAnalysis?"1":"0",sensitivityAnalysis:o.sensitivityAnalysis?"1":"0",topK:o.sensitivityAnalysis&&o.topK?o.topK.toString():""};await B(i),V.value=!1,b.success("添加分析成功"),A()}catch(i){console.error("添加鲁棒性分析失败:",i),b.error("添加分析失败，请稍后重试")}else b.error("请填写完整必填信息")})},de=async()=>{const s=E.value;s&&await s.validate(async e=>{if(e)try{const i={id:n.id,operationType:"edit",name:n.name,scalarName:n.scalarName,varianceAnalysis:n.varianceAnalysis?"1":"0",qualityAnalysis:n.qualityAnalysis?"1":"0",sensitivityAnalysis:n.sensitivityAnalysis?"1":"0",topK:n.sensitivityAnalysis&&n.topK?n.topK.toString():""};await B(i),N.value=!1,b.success("编辑分析成功"),A()}catch(i){console.error("编辑鲁棒性分析失败:",i),b.error("编辑分析失败，请稍后重试")}else b.error("请填写完整必填信息")})},pe=async s=>{_e.confirm("确定要删除该分析吗？","提示",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e={id:s.id,operationType:"delete",name:s.name,scalarName:s.scalarName,varianceAnalysis:s.varianceAnalysis,qualityAnalysis:s.qualityAnalysis,sensitivityAnalysis:s.sensitivityAnalysis,topK:s.topK};await B(e),b.success("删除分析成功"),A()}catch(e){console.error("删除鲁棒性分析失败:",e),b.error("删除分析失败，请稍后重试")}}).catch(()=>{})};return ce(async()=>{await le(),await A()}),(s,e)=>{const i=c("el-icon"),p=c("el-input"),d=c("el-button"),f=c("el-table-column"),F=c("el-table"),y=c("el-form-item"),O=c("el-option"),Q=c("el-select"),K=c("el-checkbox"),G=c("el-form"),J=c("el-dialog"),ye=ve("loading");return g(),R("div",Re,[r("div",he,[r("div",Ne,[e[17]||(e[17]=r("span",null,"鲁棒性分析列表",-1)),r("div",qe,[r("div",xe,[l(p,{modelValue:U.value,"onUpdate:modelValue":e[0]||(e[0]=a=>U.value=a),placeholder:"请输入标量名称",clearable:"",style:{width:"200px"},onInput:$,onClear:$},{suffix:t(()=>[l(i,null,{default:t(()=>[l(be(Ae))]),_:1})]),_:1},8,["modelValue"])]),l(d,{type:"primary",onClick:ie},{default:t(()=>e[16]||(e[16]=[v("添加分析")])),_:1})])]),W((g(),z(F,{data:L.value,style:{width:"100%"},"max-height":"600"},{default:t(()=>[l(f,{label:"序号",width:"100"},{default:t(a=>[v(_((u.value-1)*h.value+a.$index+1),1)]),_:1}),l(f,{prop:"name",label:"名称",width:"150"}),l(f,{prop:"scalarName",label:"标量名称",width:"150"}),l(f,{prop:"varianceAnalysis",label:"方差分析",width:"150"},{default:t(a=>[v(_(a.row.varianceAnalysis==="1"?"是":"否"),1)]),_:1}),l(f,{prop:"qualityAnalysis",label:"良品率分析",width:"150"},{default:t(a=>[v(_(a.row.qualityAnalysis==="1"?"是":"否"),1)]),_:1}),l(f,{prop:"sensitivityAnalysis",label:"敏感性分析",width:"150"},{default:t(a=>[v(_(a.row.sensitivityAnalysis==="1"?"是":"否"),1)]),_:1}),l(f,{prop:"topK",label:"敏感参数TopK",width:"150"}),l(f,{fixed:"right",label:"操作","min-width":"120"},{default:t(a=>[l(d,{link:"",type:"primary",size:"small",onClick:j=>re(a.row)},{default:t(()=>e[18]||(e[18]=[v(" 编辑 ")])),_:2},1032,["onClick"]),l(d,{link:"",type:"danger",size:"small",onClick:j=>pe(a.row)},{default:t(()=>e[19]||(e[19]=[v(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[ye,T.value]]),r("div",we,[r("span",ke,"共 "+_(D.value)+" 条",1),r("div",Ce,[W(r("select",{"onUpdate:modelValue":e[1]||(e[1]=a=>h.value=a),onChange:se},[(g(),R(C,null,S(Y,a=>r("option",{key:a,value:a},_(a)+" 条/页 ",9,Se)),64))],544),[[fe,h.value]])]),r("button",{disabled:u.value===1,class:"pagination-btn",onClick:te}," 上一页 ",8,Te),r("div",Ue,[(g(!0),R(C,null,S(ae.value,a=>(g(),R("span",{key:a,class:ge(["page-item",{active:a===u.value}]),onClick:j=>oe(a)},_(a),11,De))),128))]),r("button",{disabled:u.value===q.value,class:"pagination-btn",onClick:ne}," 下一页 ",8,Me)]),l(J,{title:"添加鲁棒性分析",modelValue:V.value,"onUpdate:modelValue":e[8]||(e[8]=a=>V.value=a),width:"600px","before-close":w},{footer:t(()=>[r("span",Pe,[l(d,{onClick:w},{default:t(()=>e[20]||(e[20]=[v("取消")])),_:1}),l(d,{type:"primary",onClick:ue},{default:t(()=>e[21]||(e[21]=[v("确认")])),_:1})])]),default:t(()=>[l(G,{model:o,rules:Z,ref_key:"addRobustnessAnalysisFormRef",ref:P,"label-width":"150px"},{default:t(()=>[l(y,{label:"名称",prop:"name"},{default:t(()=>[l(p,{modelValue:o.name,"onUpdate:modelValue":e[2]||(e[2]=a=>o.name=a),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),l(y,{label:"标量名称",prop:"scalarName"},{default:t(()=>[l(Q,{modelValue:o.scalarName,"onUpdate:modelValue":e[3]||(e[3]=a=>o.scalarName=a),placeholder:"请选择标量名称",loading:x.value},{default:t(()=>[(g(!0),R(C,null,S(M.value,a=>(g(),z(O,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(y,{label:"方差分析",prop:"varianceAnalysis"},{default:t(()=>[l(K,{modelValue:o.varianceAnalysis,"onUpdate:modelValue":e[4]||(e[4]=a=>o.varianceAnalysis=a),label:"启用"},null,8,["modelValue"])]),_:1}),l(y,{label:"良品率分析",prop:"qualityAnalysis"},{default:t(()=>[l(K,{modelValue:o.qualityAnalysis,"onUpdate:modelValue":e[5]||(e[5]=a=>o.qualityAnalysis=a),label:"启用"},null,8,["modelValue"])]),_:1}),l(y,{label:"敏感性分析",prop:"sensitivityAnalysis"},{default:t(()=>[l(K,{modelValue:o.sensitivityAnalysis,"onUpdate:modelValue":e[6]||(e[6]=a=>o.sensitivityAnalysis=a),label:"启用"},null,8,["modelValue"])]),_:1}),l(y,{label:"敏感参数TopK（启动敏感性分析时有效）",prop:"topK"},{default:t(()=>[l(p,{modelValue:o.topK,"onUpdate:modelValue":e[7]||(e[7]=a=>o.topK=a),modelModifiers:{number:!0},type:"number",placeholder:"请输入TopK（≥1）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),l(J,{title:"编辑鲁棒性分析",modelValue:N.value,"onUpdate:modelValue":e[15]||(e[15]=a=>N.value=a),width:"600px","before-close":w},{footer:t(()=>[r("span",Ee,[l(d,{onClick:w},{default:t(()=>e[22]||(e[22]=[v("取消")])),_:1}),l(d,{type:"primary",onClick:de},{default:t(()=>e[23]||(e[23]=[v("确认")])),_:1})])]),default:t(()=>[l(G,{model:n,rules:ee,ref_key:"editRobustnessAnalysisFormRef",ref:E,"label-width":"150px"},{default:t(()=>[l(y,{label:"名称",prop:"name"},{default:t(()=>[l(p,{modelValue:n.name,"onUpdate:modelValue":e[9]||(e[9]=a=>n.name=a),placeholder:"请输入名称"},null,8,["modelValue"])]),_:1}),l(y,{label:"标量名称",prop:"scalarName"},{default:t(()=>[l(Q,{modelValue:n.scalarName,"onUpdate:modelValue":e[10]||(e[10]=a=>n.scalarName=a),placeholder:"请选择标量名称",loading:x.value},{default:t(()=>[(g(!0),R(C,null,S(M.value,a=>(g(),z(O,{key:a,label:a,value:a},null,8,["label","value"]))),128))]),_:1},8,["modelValue","loading"])]),_:1}),l(y,{label:"方差分析",prop:"varianceAnalysis"},{default:t(()=>[l(K,{modelValue:n.varianceAnalysis,"onUpdate:modelValue":e[11]||(e[11]=a=>n.varianceAnalysis=a),label:"启用"},null,8,["modelValue"])]),_:1}),l(y,{label:"良品率分析",prop:"qualityAnalysis"},{default:t(()=>[l(K,{modelValue:n.qualityAnalysis,"onUpdate:modelValue":e[12]||(e[12]=a=>n.qualityAnalysis=a),label:"启用"},null,8,["modelValue"])]),_:1}),l(y,{label:"敏感性分析",prop:"sensitivityAnalysis"},{default:t(()=>[l(K,{modelValue:n.sensitivityAnalysis,"onUpdate:modelValue":e[13]||(e[13]=a=>n.sensitivityAnalysis=a),label:"启用"},null,8,["modelValue"])]),_:1}),l(y,{label:"敏感参数TopK（启动敏感性分析时有效）",prop:"topK"},{default:t(()=>[l(p,{modelValue:n.topK,"onUpdate:modelValue":e[14]||(e[14]=a=>n.topK=a),modelModifiers:{number:!0},type:"number",placeholder:"请输入TopK（≥1）"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])])])}}}),Qe=Ve(Fe,[["__scopeId","data-v-be40f3cb"]]);export{Qe as default};
