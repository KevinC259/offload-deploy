import{d as et,r as d,M as st,L as at,G as ot,H as nt,c as u,a as e,z as y,b as $,w as W,f as E,p,P as L,F as M,n as x,R as k,E as c,u as lt,Q as ut,t as m,y as B,e as it,k as U,J as rt,o as i,_ as dt}from"./index-CSkJ4Wth.js";import{r as b}from"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const vt=v=>b.post("/station/getStationList",v),pt=v=>b.post("/station/addStation",v),ct=v=>b.post("/station/updateStation",v),mt=v=>b.post("/station/deleteStation",v),ft=()=>b.post("/manage/getMenuItemList"),gt={class:"workstation-page"},yt={key:0,class:"no-permission"},kt={key:1},bt={key:0,class:"search-filter-area"},St={class:"filter-group"},wt={class:"custom-search"},_t={class:"custom-select"},It=["value"],Nt={class:"workstation-grid"},Mt=["onClick"],xt=["onClick"],Ut={class:"card-content"},ht={key:1,class:"dialog-overlay"},Ct={class:"dialog-content"},Dt={class:"form-group"},Vt={class:"form-group"},$t=["value"],Lt={class:"form-group"},At=["disabled"],Wt={class:"dialog-buttons"},Et={key:2,class:"dialog-overlay"},Bt={class:"dialog-content"},Pt={class:"form-group"},Tt={class:"form-group"},Ft={class:"form-group"},Rt=["value"],qt={class:"form-group"},zt=["disabled"],Ht={class:"dialog-buttons"},Qt=et({__name:"StaionListView",setup(v){const S=d([]),l=d({stationAdd:!1,stationDelete:!1,stationUpdate:!1,stationSearch:!1}),P=st(()=>l.value.stationAdd||l.value.stationDelete||l.value.stationUpdate||l.value.stationSearch),h=d(""),C=d(""),w=[{value:"free",label:"空闲"},{value:"inUse",label:"使用中"},{value:"underMaintenance",label:"维护中"}],T=a=>{const t=w.find(f=>f.value===a);return t?t.label:a},_=d(!1),I=d(!1),o=d(null),F=d(-1),n=at({ip:"",status:"free",useName:""}),A=d(0);let N=null;const R=a=>{A.value;const t=parseInt(a,10);if(isNaN(t))return"00:00:00";const r=Math.floor(Date.now()/1e3)-t;if(r<0)return"00:00:00";const s=Math.floor(r/3600),V=Math.floor(r%3600/60),X=r%60,Y=s.toString().padStart(2,"0"),Z=V.toString().padStart(2,"0"),tt=X.toString().padStart(2,"0");return`${Y}:${Z}:${tt}`},q=a=>`WS-${a<100?a.toString().padStart(3,"0"):a.toString()}`,g=async(a,t)=>{const f={keywords:a,status:t};try{const r=await vt(f);S.value=r}catch(r){console.log(r)}},D=()=>{g(h.value,C.value)},z=()=>{if(S.value.length>=20){c({type:"warning",message:"工作站数量已达上限！"});return}n.ip=j(),n.status="free",n.useName="-",_.value=!0},H=async()=>{n.status==="free"?n.useName="-":n.status==="underMaintenance"&&n.useName==="-"&&(n.useName="运维团队");try{await pt(n),g("",""),_.value=!1,c({type:"success",message:"添加成功"})}catch(a){c({type:"error",message:"添加失败："+a.message})}},Q=a=>{F.value=S.value.findIndex(t=>t.id===a.id),o.value={...a},I.value=!0},G=async()=>{if(o.value){o.value.status==="free"?o.value.useName="-":o.value.status==="underMaintenance"&&o.value.useName==="-"&&(o.value.useName="运维团队");try{const a={id:o.value.id,ip:o.value.ip,status:o.value.status,useName:o.value.useName};await ct(a),g("",""),I.value=!1,c({type:"success",message:"保存成功"})}catch(a){c({type:"error",message:"保存失败："+a.message})}}},J=a=>{rt.confirm(`确定要删除工作站 ${a.id} 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{await mt({id:a.id}),g("",""),c({type:"success",message:"删除成功"})}catch(t){c({type:"error",message:"删除失败："+t.message})}}).catch(()=>{c({type:"info",message:"已取消删除"})})},O=a=>{switch(a){case"free":return"status-free-card";case"inUse":return"status-in-use-card";case"underMaintenance":return"status-maintenance-card";default:return""}},j=()=>`192.168.${Math.floor(Math.random()*255)}.${Math.floor(Math.random()*255)}`,K=async()=>{(await ft()).forEach(t=>{switch(t.value){case"stationAdd":l.value.stationAdd=!0;break;case"stationDelete":l.value.stationDelete=!0;break;case"stationUpdate":l.value.stationUpdate=!0;break;case"stationSearch":l.value.stationSearch=!0;break}})};return ot(()=>{K(),g("",""),N=window.setInterval(()=>{A.value++},1e3)}),nt(()=>{N&&(clearInterval(N),N=null)}),(a,t)=>{const f=E("el-icon"),r=E("el-input");return i(),u("div",gt,[P.value?(i(),u("div",kt,[l.value.stationSearch?(i(),u("div",bt,[e("div",St,[e("div",wt,[$(r,{modelValue:h.value,"onUpdate:modelValue":t[0]||(t[0]=s=>h.value=s),placeholder:"搜索ID或IP地址",clearable:"",style:{width:"280px"},onInput:D,onClear:D},{suffix:W(()=>[$(f,null,{default:W(()=>[$(lt(ut))]),_:1})]),_:1},8,["modelValue"])]),e("div",_t,[p(e("select",{"onUpdate:modelValue":t[1]||(t[1]=s=>C.value=s),onChange:D},[t[12]||(t[12]=e("option",{value:""},"全部状态",-1)),(i(),u(M,null,x(w,s=>e("option",{key:s.value,value:s.value},m(s.label),9,It)),64))],544),[[L,C.value]])])])])):y("",!0),e("div",Nt,[(i(!0),u(M,null,x(S.value,s=>(i(),u("div",{key:s.id,class:B(["workstation-card",O(s.status)]),onClick:V=>l.value.stationUpdate?Q(s):null},[l.value.stationDelete?(i(),u("div",{key:0,class:"delete-icon",onClick:it(V=>J(s),["stop"])},"×",8,xt)):y("",!0),e("div",Ut,[e("p",null,[t[13]||(t[13]=e("strong",null,"ID:",-1)),U(" "+m(q(s.id)),1)]),e("p",null,[t[14]||(t[14]=e("strong",null,"IP 地址:",-1)),U(" "+m(s.ip),1)]),e("p",null,[t[15]||(t[15]=e("strong",null,"使用状态:",-1)),e("span",{class:B(`status-text status-${s.status}`)},m(T(s.status)),3)]),e("p",null,[t[16]||(t[16]=e("strong",null,"使用人:",-1)),U(" "+m(s.useName),1)]),e("p",null,[t[17]||(t[17]=e("strong",null,"使用时间:",-1)),U(" "+m(R(s.startTime)),1)])])],10,Mt))),128)),l.value.stationAdd?(i(),u("div",{key:0,class:"workstation-card add-card",onClick:z},t[18]||(t[18]=[e("span",{class:"plus-icon"},"+",-1)]))):y("",!0)]),l.value.stationAdd&&_.value?(i(),u("div",ht,[e("div",Ct,[t[22]||(t[22]=e("h2",null,"添加新工作站",-1)),e("div",Dt,[t[19]||(t[19]=e("label",null,"IP 地址:",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[2]||(t[2]=s=>n.ip=s)},null,512),[[k,n.ip]])]),e("div",Vt,[t[20]||(t[20]=e("label",null,"使用状态:",-1)),p(e("select",{"onUpdate:modelValue":t[3]||(t[3]=s=>n.status=s)},[(i(),u(M,null,x(w,s=>e("option",{key:s.value,value:s.value},m(s.label),9,$t)),64))],512),[[L,n.status]])]),e("div",Lt,[t[21]||(t[21]=e("label",null,"使用人:",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[4]||(t[4]=s=>n.useName=s),disabled:n.status==="free"},null,8,At),[[k,n.useName]])]),e("div",Wt,[e("button",{onClick:H},"确认"),e("button",{onClick:t[5]||(t[5]=s=>_.value=!1)},"取消")])])])):y("",!0),l.value.stationUpdate&&I.value&&o.value?(i(),u("div",Et,[e("div",Bt,[t[27]||(t[27]=e("h2",null,"编辑工作站",-1)),e("div",Pt,[t[23]||(t[23]=e("label",null,"ID:",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[6]||(t[6]=s=>o.value.id=s),disabled:""},null,512),[[k,o.value.id]])]),e("div",Tt,[t[24]||(t[24]=e("label",null,"IP 地址:",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[7]||(t[7]=s=>o.value.ip=s)},null,512),[[k,o.value.ip]])]),e("div",Ft,[t[25]||(t[25]=e("label",null,"使用状态:",-1)),p(e("select",{"onUpdate:modelValue":t[8]||(t[8]=s=>o.value.status=s)},[(i(),u(M,null,x(w,s=>e("option",{key:s.value,value:s.value},m(s.label),9,Rt)),64))],512),[[L,o.value.status]])]),e("div",qt,[t[26]||(t[26]=e("label",null,"使用人:",-1)),p(e("input",{type:"text","onUpdate:modelValue":t[9]||(t[9]=s=>o.value.useName=s),disabled:o.value.status==="free"},null,8,zt),[[k,o.value.useName]])]),e("div",Ht,[e("button",{onClick:G},"保存"),e("button",{onClick:t[10]||(t[10]=s=>I.value=!1)},"取消")])])])):y("",!0)])):(i(),u("div",yt,t[11]||(t[11]=[e("h2",null,"无权查看工作站信息",-1)])))])}}}),Kt=dt(Qt,[["__scopeId","data-v-b8f5ee7b"]]);export{Kt as default};
