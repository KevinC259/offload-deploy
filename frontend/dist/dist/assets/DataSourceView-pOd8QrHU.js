import{d as be,M as P,I as Se,r as f,L as R,G as Ve,c as T,a as c,z as we,p as W,b as a,w as l,f as g,O as De,i as he,u as X,T as ke,t as h,P as Ne,F as Y,n as Z,N as Ce,E as w,Q as Te,k as p,y as xe,J as Ue,g as Le,o as k,_ as Me}from"./index-CSkJ4Wth.js";import{f as qe,h as $,e as Fe}from"./function-CwdAX250.js";import"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const Pe={class:"dataSourceList-container"},Re={class:"dataSourceList-table"},ze={class:"dataSourceList-header"},Ee={class:"dataSourceList-header-right"},Be={class:"dataSourceList-header-search"},Ie={class:"custom-pagination"},Oe={class:"pagination-total"},$e={class:"pagination-sizes"},Je=["value"],Ae=["disabled"],Ke={class:"pagination-pages"},Qe=["onClick"],je=["disabled"],Ge={class:"dialog-footer"},He={class:"dialog-footer"},We={key:0,class:"global-actions"},Xe=be({__name:"DataSourceView",setup(Ye){const z=Le(),x=Se(),E=P(()=>x.name==="nav_dataSource"),J=f(),B=f(!0),_=f([]),I=f([]),U=f(0),i=f(1),b=f(10),ee=[10,20,50],y=f(""),L=f(!1),M=f(!1),q=f(),F=f(),n=R({sourceType:"",sourceName:"",dimension:null,start:"",end:""}),s=R({id:"",sourceType:"",sourceName:"",dimension:null,start:"",end:""}),A=(o,e,d)=>{e==null?d(new Error("请输入数据维度")):d()},ae=R({sourceType:[{required:!0,message:"请选择数据源类型",trigger:"change"}],sourceName:[{required:!0,message:"请输入数据源名称",trigger:"blur"}],dimension:[{required:!0,validator:A,trigger:"blur"}]}),te=R({sourceType:[{required:!0,message:"请选择数据源类型",trigger:"change"}],sourceName:[{required:!0,message:"请输入数据源名称",trigger:"blur"}],dimension:[{required:!0,validator:A,trigger:"blur"}]}),N=P(()=>Math.ceil(U.value/b.value)||1),oe=P(()=>{const o=(i.value-1)*b.value,e=o+b.value;return I.value.slice(o,e)}),le=P(()=>{if(N.value===0)return[1];const o=[],e=5;let d=Math.max(1,i.value-2),r=Math.min(N.value,d+e-1);r-d+1<e&&(d=Math.max(1,r-e+1));for(let u=d;u<=r;u++)o.push(u);return o}),S=async(o="")=>{var e;B.value=!0;try{const d={name:o,page:{pageNum:i.value,pageSize:b.value}},r=await qe(d),u=((r==null?void 0:r.list)||[]).map((v,V)=>{if(!v.start&&!v.end){const C=["1.0","2.0","0.5","3.0","1.5"],m=["10.0","8.0","15.0","12.0","9.5"];return{...v,start:C[V%C.length],end:m[V%m.length]}}return v});_.value=u,I.value=[..._.value],U.value=(r==null?void 0:r.total)||0,await Ce(),(e=J.value)==null||e.doLayout()}catch(d){console.error("获取数据源列表失败",d)}finally{B.value=!1}},O=async()=>{await S(y.value),w.success("操作成功")},K=async()=>{i.value=1,await S(y.value)},ne=async()=>{i.value=1,await S(y.value)},re=async()=>{i.value>1&&(i.value--,await S(y.value))},se=async()=>{i.value<N.value&&(i.value++,await S(y.value))},ue=async o=>{o>=1&&o<=N.value&&o!==i.value&&(i.value=o,await S(y.value))},ie=()=>{var o;L.value=!0,(o=q.value)==null||o.resetFields(),n.sourceType="",n.sourceName="",n.dimension=null,n.start="",n.end=""},de=o=>{var e;M.value=!0,Object.assign(s,o),(e=F.value)==null||e.clearValidate()},D=()=>{L.value=!1,M.value=!1},ce=async()=>{if(q.value)try{await q.value.validate();const o={id:"",operationType:"add",sourceName:n.sourceName,dimension:n.dimension.toString(),sourceType:n.sourceType,start:n.start,end:n.end};await $(o),await O(),D()}catch{w.error("请检查表单信息是否填写完整且正确")}},me=async()=>{if(F.value)try{await F.value.validate();const o={id:s.id,operationType:"edit",sourceName:s.sourceName,dimension:s.dimension.toString(),sourceType:s.sourceType,start:s.start,end:s.end};await $(o),await O(),D()}catch{w.error("请检查表单信息是否填写完整且正确")}},pe=o=>{Ue.confirm(`确定要删除数据源 "${o.sourceName}" 吗？`,"删除确认",{confirmButtonText:"确定",cancelButtonText:"取消",type:"warning"}).then(async()=>{try{const e={id:o.id,operationType:"delete",sourceName:"",dimension:"",sourceType:""};await $(e),await O()}catch(e){console.error("删除数据源失败",e)}}).catch(()=>{})},ve=()=>{E.value?z.push({name:"nav_optimizeVariables"}):z.back()},Q=async()=>{try{const o=`dataSource_${String(x.name)}`,e={dataSourceList:_.value,timestamp:new Date().toISOString(),routeName:x.name};localStorage.setItem(o,JSON.stringify(e))}catch(o){console.error("保存配置失败:",o),w.error("保存配置失败")}},fe=async()=>{try{const o={dataSourceList:_.value,timestamp:new Date().toISOString(),stepName:"数据源"};await Fe(),console.log("数据源配置已保存到后端:",o)}catch(o){throw console.error("保存配置失败:",o),o}},ge=async()=>{try{await Q(),await fe(),w.success("配置已保存并导出，正在跳转到下一步"),z.push({name:"nav_scalar"})}catch(o){console.error("下一步操作失败:",o),w.error("操作失败，请重试")}},ye=()=>{if(E.value)try{const o=`dataSource_${String(x.name)}`,e=localStorage.getItem(o);if(e){const d=JSON.parse(e);_.value=d.dataSourceList||[],I.value=[..._.value],U.value=_.value.length,w.success("已加载保存的配置")}}catch(o){console.error("加载配置失败:",o)}};return Ve(()=>{ye(),S()}),(o,e)=>{const d=g("el-icon"),r=g("el-input"),u=g("el-button"),v=g("el-table-column"),V=g("el-option"),C=g("el-select"),m=g("el-form-item"),j=g("el-form"),G=g("el-dialog"),_e=De("loading");return k(),T("div",Pe,[c("div",Re,[c("div",ze,[e[15]||(e[15]=c("span",null,"数据源列表",-1)),c("div",Ee,[c("div",Be,[a(r,{modelValue:y.value,"onUpdate:modelValue":e[0]||(e[0]=t=>y.value=t),placeholder:"请输入数据源名称",clearable:"",style:{width:"200px"},onInput:K,onClear:K},{suffix:l(()=>[a(d,null,{default:l(()=>[a(X(Te))]),_:1})]),_:1},8,["modelValue"])]),a(u,{type:"primary",onClick:ie},{default:l(()=>e[14]||(e[14]=[p("添加数据源")])),_:1})])]),W((k(),he(X(ke),{data:oe.value,style:{width:"100%"},"max-height":"600",ref_key:"tableRef",ref:J},{default:l(()=>[a(v,{label:"序号",width:"150"},{default:l(t=>[p(h((i.value-1)*b.value+t.$index+1),1)]),_:1}),a(v,{prop:"sourceName",label:"数据源名称",width:"300"}),a(v,{prop:"dimension",label:"数据维度",width:"150"}),a(v,{prop:"sourceType",label:"数据源类型",width:"150"}),a(v,{prop:"start",label:"频段起始点",width:"150"},{default:l(t=>[p(h(t.row.start||"-"),1)]),_:1}),a(v,{prop:"end",label:"频段终止点",width:"150"},{default:l(t=>[p(h(t.row.end||"-"),1)]),_:1}),a(v,{fixed:"right",label:"操作","min-width":"120"},{default:l(t=>[a(u,{link:"",type:"primary",size:"small",onClick:H=>de(t.row)},{default:l(()=>e[16]||(e[16]=[p(" 编辑 ")])),_:2},1032,["onClick"]),a(u,{link:"",type:"danger",size:"small",onClick:H=>pe(t.row)},{default:l(()=>e[17]||(e[17]=[p(" 删除 ")])),_:2},1032,["onClick"])]),_:1})]),_:1},8,["data"])),[[_e,B.value]]),c("div",Ie,[c("span",Oe,"共 "+h(U.value)+" 条",1),c("div",$e,[W(c("select",{"onUpdate:modelValue":e[1]||(e[1]=t=>b.value=t),onChange:ne},[(k(),T(Y,null,Z(ee,t=>c("option",{key:t,value:t},h(t)+" 条/页 ",9,Je)),64))],544),[[Ne,b.value]])]),c("button",{disabled:i.value===1,class:"pagination-btn",onClick:re}," 上一页 ",8,Ae),c("div",Ke,[(k(!0),T(Y,null,Z(le.value,t=>(k(),T("span",{key:t,class:xe(["page-item",{active:t===i.value}]),onClick:H=>ue(t)},h(t),11,Qe))),128))]),c("button",{disabled:i.value===N.value,class:"pagination-btn",onClick:se}," 下一页 ",8,je)]),a(G,{title:"添加数据源",modelValue:L.value,"onUpdate:modelValue":e[7]||(e[7]=t=>L.value=t),width:"600px","before-close":D},{footer:l(()=>[c("span",Ge,[a(u,{onClick:D},{default:l(()=>e[18]||(e[18]=[p("取消")])),_:1}),a(u,{type:"primary",onClick:ce},{default:l(()=>e[19]||(e[19]=[p("确认")])),_:1})])]),default:l(()=>[a(j,{model:n,rules:ae,ref_key:"addDataSourceFormRef",ref:q,"label-width":"120px"},{default:l(()=>[a(m,{label:"数据源类型",prop:"sourceType"},{default:l(()=>[a(C,{modelValue:n.sourceType,"onUpdate:modelValue":e[2]||(e[2]=t=>n.sourceType=t),placeholder:"请选择数据源类型"},{default:l(()=>[a(V,{label:"curve",value:"curve"}),a(V,{label:"table",value:"table"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"数据源名称",prop:"sourceName"},{default:l(()=>[a(r,{modelValue:n.sourceName,"onUpdate:modelValue":e[3]||(e[3]=t=>n.sourceName=t),placeholder:"请输入数据源名称"},null,8,["modelValue"])]),_:1}),a(m,{label:"数据维度",prop:"dimension"},{default:l(()=>[a(r,{modelValue:n.dimension,"onUpdate:modelValue":e[4]||(e[4]=t=>n.dimension=t),modelModifiers:{number:!0},type:"number",placeholder:"请输入数据维度（≥1）"},null,8,["modelValue"])]),_:1}),a(m,{label:"频段起始点",prop:"start"},{default:l(()=>[a(r,{modelValue:n.start,"onUpdate:modelValue":e[5]||(e[5]=t=>n.start=t),placeholder:"请输入频段起始点"},null,8,["modelValue"])]),_:1}),a(m,{label:"频段终止点",prop:"end"},{default:l(()=>[a(r,{modelValue:n.end,"onUpdate:modelValue":e[6]||(e[6]=t=>n.end=t),placeholder:"请输入频段终止点"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"]),a(G,{title:"编辑数据源",modelValue:M.value,"onUpdate:modelValue":e[13]||(e[13]=t=>M.value=t),width:"600px","before-close":D},{footer:l(()=>[c("span",He,[a(u,{onClick:D},{default:l(()=>e[20]||(e[20]=[p("取消")])),_:1}),a(u,{type:"primary",onClick:me},{default:l(()=>e[21]||(e[21]=[p("确认")])),_:1})])]),default:l(()=>[a(j,{model:s,rules:te,ref_key:"editDataSourceFormRef",ref:F,"label-width":"120px"},{default:l(()=>[a(m,{label:"数据源类型",prop:"sourceType"},{default:l(()=>[a(C,{modelValue:s.sourceType,"onUpdate:modelValue":e[8]||(e[8]=t=>s.sourceType=t),placeholder:"请选择数据源类型"},{default:l(()=>[a(V,{label:"curve",value:"curve"}),a(V,{label:"table",value:"table"})]),_:1},8,["modelValue"])]),_:1}),a(m,{label:"数据源名称",prop:"sourceName"},{default:l(()=>[a(r,{modelValue:s.sourceName,"onUpdate:modelValue":e[9]||(e[9]=t=>s.sourceName=t),placeholder:"请输入数据源名称"},null,8,["modelValue"])]),_:1}),a(m,{label:"数据维度",prop:"dimension"},{default:l(()=>[a(r,{modelValue:s.dimension,"onUpdate:modelValue":e[10]||(e[10]=t=>s.dimension=t),modelModifiers:{number:!0},type:"number",placeholder:"请输入数据维度（≥1）"},null,8,["modelValue"])]),_:1}),a(m,{label:"频段起始点",prop:"start"},{default:l(()=>[a(r,{modelValue:s.start,"onUpdate:modelValue":e[11]||(e[11]=t=>s.start=t),placeholder:"请输入频段起始点"},null,8,["modelValue"])]),_:1}),a(m,{label:"频段终止点",prop:"end"},{default:l(()=>[a(r,{modelValue:s.end,"onUpdate:modelValue":e[12]||(e[12]=t=>s.end=t),placeholder:"请输入频段终止点"},null,8,["modelValue"])]),_:1})]),_:1},8,["model","rules"])]),_:1},8,["modelValue"])]),E.value?(k(),T("div",We,[a(u,{onClick:ve},{default:l(()=>e[22]||(e[22]=[p("返回")])),_:1}),a(u,{type:"primary",onClick:Q},{default:l(()=>e[23]||(e[23]=[p("保存配置")])),_:1}),a(u,{type:"primary",onClick:ge},{default:l(()=>e[24]||(e[24]=[p("下一步")])),_:1})])):we("",!0)])}}}),la=Me(Xe,[["__scopeId","data-v-fdcafb0c"]]);export{la as default};
