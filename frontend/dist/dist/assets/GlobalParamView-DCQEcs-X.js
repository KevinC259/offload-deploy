import{d as w,M as N,I as O,L as b,G as P,c as v,a,z as I,b as i,w as u,f as g,S as x,E as s,k as m,g as G,o as y,_ as j}from"./index-CSkJ4Wth.js";import{b as U,c as z,e as B}from"./function-CwdAX250.js";import"./request-Bb7olHYx.js";import"./index-xsH4HHeE.js";import"./auth-CnjZ6pwZ.js";const E={class:"global-param-view"},R={class:"card global-param-section"},T={key:0,class:"global-actions"},A={class:"form-group"},J={style:{flex:"1"}},K={class:"form-group"},L={style:{flex:"1"}},$={class:"form-group"},F={style:{flex:"1"}},q={class:"form-group"},H={style:{flex:"1"}},Q={class:"form-group"},X={style:{flex:"1"}},Y={class:"form-actions"},Z=w({__name:"GlobalParamView",setup(ee){const p=G(),d=O(),c=N(()=>d.name==="nav_globalParam"),t=b({iterationCount:100,initSamples:!0,sampleCount:50,useWeightedSum:!1,useMaxDiff:!0}),r=b({iterationCount:100,initSamples:!0,sampleCount:50,useWeightedSum:!1,useMaxDiff:!0}),_=async()=>{const o=x.service({lock:!0,text:"加载中...",background:"rgba(0, 0, 0, 0.7)"});try{const e=await U();e?(Object.assign(t,{iterationCount:e.iterationCount||100,initSamples:e.initSamples!==void 0?e.initSamples:!0,sampleCount:e.sampleCount||50,useWeightedSum:e.useWeightedSum!==void 0?e.useWeightedSum:!1,useMaxDiff:e.useMaxDiff!==void 0?e.useMaxDiff:!0}),console.log("加载全局参数成功:",e),Object.assign(r,{iterationCount:e.iterationCount||100,initSamples:e.initSamples!==void 0?e.initSamples:!0,sampleCount:e.sampleCount||50,useWeightedSum:e.useWeightedSum!==void 0?e.useWeightedSum:!1,useMaxDiff:e.useMaxDiff!==void 0?e.useMaxDiff:!0}),s.success("全局参数加载成功")):(console.warn("API 返回空数据，使用默认值"),s.warning("未获取到服务器数据，使用默认值"))}catch(e){console.error("加载全局参数失败:",e),s.error("加载全局参数失败，使用默认值")}finally{o.close()}},D=async()=>{if(!t.iterationCount||t.iterationCount<=0){s.error("优化迭代次数必须为正整数");return}if(!t.sampleCount||t.sampleCount<=0){s.error("初始化样本数量必须为正整数");return}const o=x.service({lock:!0,text:"保存中...",background:"rgba(0, 0, 0, 0.7)"});try{const e={iterationCount:t.iterationCount,initSamples:t.initSamples,sampleCount:t.sampleCount,useWeightedSum:t.useWeightedSum,useMaxDiff:t.useMaxDiff};await z(e),Object.assign(r,e),s.success("参数保存成功"),console.log("保存的参数:",e)}catch{console.error("保存全局参数失败:",t),s.error("保存失败，请稍后重试")}finally{o.close()}},M=()=>{Object.assign(t,{iterationCount:r.iterationCount,initSamples:r.initSamples,sampleCount:r.sampleCount,useWeightedSum:r.useWeightedSum,useMaxDiff:r.useMaxDiff}),s.success("参数已重置为数据库中的值")},V=()=>{c.value?p.push({name:"nav_optimizationTargets"}):p.back()},C=async()=>{try{const o=`globalParam_${String(d.name)}`,e={...t,timestamp:new Date().toISOString(),routeName:d.name};localStorage.setItem(o,JSON.stringify(e))}catch(o){console.error("保存配置失败:",o),s.error("保存配置失败")}},h=async()=>{try{const o={globalParam:t,timestamp:new Date().toISOString(),stepName:"全局参数"};await B(),console.log("全局参数配置已保存到后端:",o)}catch(o){console.error("保存配置失败:",o),s.error("保存配置失败")}},k=async()=>{try{await C(),await h(),s.success("配置已保存并导出，正在跳转到下一步"),p.push({name:"nav_optimizeAlgorithm"})}catch(o){console.error("下一步操作失败:",o),s.error("操作失败，请重试")}},W=()=>{if(c.value)try{const o=`globalParam_${String(d.name)}`,e=localStorage.getItem(o);if(e){const n=JSON.parse(e);Object.assign(t,{iterationCount:n.iterationCount,initSamples:n.initSamples,sampleCount:n.sampleCount,useWeightedSum:n.useWeightedSum,useMaxDiff:n.useMaxDiff})}}catch(o){console.error("加载配置失败:",o)}};return P(()=>{W(),_()}),(o,e)=>{const n=g("el-button"),S=g("el-input"),f=g("el-checkbox");return y(),v("div",E,[a("div",R,[c.value?(y(),v("div",T,[i(n,{onClick:V},{default:u(()=>e[5]||(e[5]=[m("返回")])),_:1}),i(n,{type:"primary",onClick:C},{default:u(()=>e[6]||(e[6]=[m("保存配置")])),_:1}),i(n,{type:"primary",onClick:k},{default:u(()=>e[7]||(e[7]=[m("下一步")])),_:1})])):I("",!0),e[15]||(e[15]=a("span",{class:"card-title"},"全局优化参数",-1)),a("div",A,[e[8]||(e[8]=a("label",null,"*优化迭代次数",-1)),a("div",J,[i(S,{modelValue:t.iterationCount,"onUpdate:modelValue":e[0]||(e[0]=l=>t.iterationCount=l),modelModifiers:{number:!0},type:"number",placeholder:"请输入迭代次数"},null,8,["modelValue"])])]),a("div",K,[e[9]||(e[9]=a("label",null,"*是否初始化样本",-1)),a("div",L,[i(f,{modelValue:t.initSamples,"onUpdate:modelValue":e[1]||(e[1]=l=>t.initSamples=l)},null,8,["modelValue"])])]),a("div",$,[e[10]||(e[10]=a("label",null,"*初始化样本数量",-1)),a("div",F,[i(S,{modelValue:t.sampleCount,"onUpdate:modelValue":e[2]||(e[2]=l=>t.sampleCount=l),modelModifiers:{number:!0},type:"number",placeholder:"请输入样本数量"},null,8,["modelValue"])])]),a("div",q,[e[11]||(e[11]=a("label",null,"采用差距加权和计算目标函数",-1)),a("div",H,[i(f,{modelValue:t.useWeightedSum,"onUpdate:modelValue":e[3]||(e[3]=l=>t.useWeightedSum=l)},null,8,["modelValue"])])]),a("div",Q,[e[12]||(e[12]=a("label",null,"使用最大差距作为目标函数",-1)),a("div",X,[i(f,{modelValue:t.useMaxDiff,"onUpdate:modelValue":e[4]||(e[4]=l=>t.useMaxDiff=l)},null,8,["modelValue"])])]),a("div",Y,[i(n,{type:"primary",onClick:D},{default:u(()=>e[13]||(e[13]=[m("保存")])),_:1}),i(n,{onClick:M},{default:u(()=>e[14]||(e[14]=[m("重置")])),_:1})])])])}}}),ie=j(Z,[["__scopeId","data-v-08d37a64"]]);export{ie as default};
